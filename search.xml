<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android Google 登入</title>
    <url>/2021/02/06/Android%20Google%20%E7%99%BB%E5%85%A5/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Google API 實現登入功能</p>
<p>將 Google 登錄機制加入的應用中，讓用戶可使用自己的 Google 帳號進行 Firebase 身份驗證</p>
<a id="more"></a>

<img src="/img/Android Google 登入9.png" width="720px" />

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>需先申辦Firebase的帳號，並將專案與Firebase的連接。<br>以下將演示登入專案的實現方。</p>
<h3 id="專案與Firebase的連接"><a href="#專案與Firebase的連接" class="headerlink" title="專案與Firebase的連接"></a>專案與Firebase的連接</h3><p>開啟新專案，點選Tool-&gt;Firebase,待跳出右邊視窗後，選Authentication-&gt;Email and password authentication</p>
<img src="/img/Android Google 登入0.png" width="1057px" />

<p>點開後將專案將專案與Firebase進行連結<br>不需要事先到Firebase中開啟新專案，直接在以下步驟中創建(Connect your app to Firebase)並連結(Add Firebase Authentication to your app)即可</p>
<img src="/img/Android Google 登入1.png" width="420px" />

<p>接著到自己的Firebase中的控制台 <a href="https://console.firebase.google.com/u/3/">https://console.firebase.google.com/u/3/</a> 點選剛剛創建的專案</p>
<img src="/img/Android Google 登入2.png" width="1057px" />

<p>接著從旁邊的authentication中進入開啟Google登入</p>
<img src="/img/Android Google 登入3.png" width="1057px" />

<p>再回到Android Studio 點選右邊的 gradle-&gt;點開專案-&gt;Task-&gt;android-&gt;signingReport便可以看到SHA1和SHA-256，等等需要將其加入Firebase的專案中<br>(執行APP時，記得將上面的模式調回app才可以執行)</p>
<img src="/img/Android Google 登入4.png" width="1057px" />

<p>到Firebase的專案總攬-&gt;專案設定</p>
<img src="/img/Android Google 登入5.png" width="1057px" />

<p>在專案設定中的一般設定裡，將剛剛的SHA1和SHA-256新增上去，設定好後，下載google-services.json檔</p>
<img src="/img/Android Google 登入6.png" width="1057px" />

<p>將google-services.json檔放入android專案中的app</p>
<img src="/img/Android Google 登入7.png" width="391px" />

<h4 id="補充說明"><a href="#補充說明" class="headerlink" title="補充說明"></a>補充說明</h4><p>官方教學文件可以點選android studio的連結進去 <a href="https://firebase.google.com/docs/auth/android/google-signin?utm_source=studio">https://firebase.google.com/docs/auth/android/google-signin?utm_source=studio</a></p>
<img src="/img/Android Google 登入8.png" width="720" />

<p>如果要將APP上架到Play Store，需要到Firebase中設定專案與Play Store的連結</p>
<img src="/img/Android Google 登入10.png" width="1057px" />

<h3 id="android-studio-gradle設定"><a href="#android-studio-gradle設定" class="headerlink" title="android studio gradle設定"></a>android studio gradle設定</h3><p>build.gradle(Project)  加入   classpath ‘com.google.gms:google-services:4.2.0’ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&quot;com.android.tools.build:gradle:4.0.1&quot;</span></span><br><span class="line">        classpath <span class="string">&#x27;com.google.gms:google-services:4.2.0&#x27;</span>  <span class="comment">//GoogleSign</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>build.gradle(app))  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Import the BoM for the Firebase platform</span></span><br><span class="line"><span class="function">implementation <span class="title">platform</span><span class="params">(<span class="string">&#x27;com.google.firebase:firebase-bom:26.2.0&#x27;</span>)</span></span></span><br><span class="line"><span class="function"><span class="comment">// Declare the dependency for the Firebase Authentication library</span></span></span><br><span class="line"><span class="function"><span class="comment">// When using the BoM, you don&#x27;t specify versions in Firebase library dependencies</span></span></span><br><span class="line"><span class="function">implementation &#x27;com.google.firebase:firebase-auth&#x27;</span></span><br><span class="line"><span class="function"><span class="comment">// Also declare the dependency for the Google Play services library and specify its version</span></span></span><br><span class="line"><span class="function">implementation &#x27;com.google.android.gms:play-services-auth:19.0.0&#x27;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">implementation &#x27;com.google.firebase:firebase-database:17.0.0&#x27;</span></span><br><span class="line"><span class="function">implementation &#x27;com.google.firebase:firebase-core:17.0.0&#x27;</span></span><br><span class="line"><span class="function">implementation &#x27;com.google.firebase:firebase-firestore:19.0.0&#x27;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//google用戶圖片</span></span></span><br><span class="line"><span class="function">implementation &#x27;com.github.bumptech.glide:glide:4.12.0&#x27;</span></span><br><span class="line"><span class="function">annotationProcessor &#x27;com.github.bumptech.glide:compiler:4.12.0&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h3><p>MainActivity </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.googlesignin;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bumptech.glide.Glide;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.auth.api.signin.GoogleSignIn;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.auth.api.signin.GoogleSignInAccount;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.auth.api.signin.GoogleSignInClient;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.auth.api.signin.GoogleSignInOptions;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.common.SignInButton;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.common.api.ApiException;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.tasks.OnCompleteListener;</span><br><span class="line"><span class="keyword">import</span> com.google.android.gms.tasks.Task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GoogleSignInClient mGoogleSignInClient;</span><br><span class="line">    <span class="keyword">private</span> SignInButton signInButton;</span><br><span class="line">    Button signOutBtn;</span><br><span class="line">    TextView nameTV,mailTV,idTV;</span><br><span class="line">    ImageView imageIV;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> RC_SIGN_IN = <span class="number">0</span>;</span><br><span class="line">    String TAG = <span class="string">&quot;GoogleSignIn&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        nameTV = findViewById(R.id.nameTV);</span><br><span class="line">        idTV = findViewById(R.id.idTV);</span><br><span class="line">        mailTV = findViewById(R.id.mailTV);</span><br><span class="line">        imageIV = findViewById(R.id.imageIV);</span><br><span class="line">        signOutBtn = findViewById(R.id.signOutBtn);</span><br><span class="line">        signInButton = findViewById(R.id.sign_in_button);</span><br><span class="line"></span><br><span class="line">        creatRequest(); <span class="comment">//配置Google登入</span></span><br><span class="line">        userSignStatus();<span class="comment">//檢查使用者是否已經有登入</span></span><br><span class="line"></span><br><span class="line">        signInButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()<span class="comment">//不用onClick的方式，因為需要在初始配置中先獲得mGoogleSignInClient</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                signIn();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">creatRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Configure Google Sign In</span></span><br><span class="line">        GoogleSignInOptions gso = <span class="keyword">new</span> GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)</span><br><span class="line">                .requestIdToken(getString(R.string.default_web_client_id)) <span class="comment">//R.string.default_web_client_id需要將系統執行一次，讓他產生</span></span><br><span class="line">                .requestEmail()</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        mGoogleSignInClient = GoogleSignIn.getClient(<span class="keyword">this</span>,gso);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">userSignStatus</span><span class="params">()</span><span class="comment">//檢查使用者是否已經有登入，有的話直接跳到ProfileActivity</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GoogleSignInAccount signInAccount = GoogleSignIn.getLastSignedInAccount(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span>(signInAccount != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            idTV.setText(signInAccount.getId());</span><br><span class="line">            nameTV.setText(signInAccount.getDisplayName());</span><br><span class="line">            mailTV.setText(signInAccount.getEmail());</span><br><span class="line">            Uri AccountUri = signInAccount.getPhotoUrl();</span><br><span class="line">            Glide.with(<span class="keyword">this</span>).load(String.valueOf(AccountUri)).into(imageIV);</span><br><span class="line"></span><br><span class="line">            signOutBtn.setVisibility(View.VISIBLE);</span><br><span class="line">            signInButton.setVisibility(View.INVISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">signIn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Intent signIntent = mGoogleSignInClient.getSignInIntent();</span><br><span class="line">        startActivityForResult(signIntent,RC_SIGN_IN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">        <span class="comment">// Result returned from launching the Intent from GoogleSignInApi.getSignInIntent(...);</span></span><br><span class="line">        <span class="keyword">if</span> (requestCode == RC_SIGN_IN) &#123;</span><br><span class="line">            Task&lt;GoogleSignInAccount&gt; task = GoogleSignIn.getSignedInAccountFromIntent(data);</span><br><span class="line">            handleSignInResult(task);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleSignInResult</span><span class="params">(Task&lt;GoogleSignInAccount&gt; completedTask)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Google Sign In was successful, authenticate with Firebase</span></span><br><span class="line">            GoogleSignInAccount signInAccount = completedTask.getResult(ApiException.class);</span><br><span class="line">            idTV.setText(signInAccount.getId());</span><br><span class="line">            nameTV.setText(signInAccount.getDisplayName());</span><br><span class="line">            mailTV.setText(signInAccount.getEmail());</span><br><span class="line">            Uri AccountUri = signInAccount.getPhotoUrl();</span><br><span class="line">            Glide.with(<span class="keyword">this</span>).load(String.valueOf(AccountUri)).into(imageIV);</span><br><span class="line"></span><br><span class="line">            signOutBtn.setVisibility(View.VISIBLE);</span><br><span class="line">            signInButton.setVisibility(View.INVISIBLE);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ApiException e) &#123;</span><br><span class="line">            <span class="comment">// Google Sign In failed, update UI appropriately</span></span><br><span class="line">            Log.w(TAG, <span class="string">&quot;Google sign in failed&quot;</span>, e);</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>,e.getMessage(),Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signOut</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        mGoogleSignInClient.signOut()</span><br><span class="line">                .addOnCompleteListener(<span class="keyword">this</span>, <span class="keyword">new</span> OnCompleteListener&lt;Void&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(<span class="meta">@NonNull</span> Task&lt;Void&gt; task)</span> </span>&#123;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">&quot;Signed Out&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        idTV.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        nameTV.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        mailTV.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        imageIV.setImageResource(R.drawable.ic_baseline_account_box_24);</span><br><span class="line"></span><br><span class="line">        signOutBtn.setVisibility(View.INVISIBLE);</span><br><span class="line">        signInButton.setVisibility(View.VISIBLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>activity_main </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;50dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/imageIV&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@drawable/ic_baseline_account_box_24&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/idTV&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nameTV&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/mailTV&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.gms.common.SignInButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/sign_in_button&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/signOutBtn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;signOut&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Sign Out&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#abcabc&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">&quot;invisible&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://www.youtube.com/watch?v=t-yZUqthDMM">https://www.youtube.com/watch?v=t-yZUqthDMM</a><br><a href="https://www.youtube.com/watch?v=E1eqRNTZqDM">https://www.youtube.com/watch?v=E1eqRNTZqDM</a><br>官方教學: <a href="https://firebase.google.com/docs/auth/android/google-signin?utm_source=studio">https://firebase.google.com/docs/auth/android/google-signin?utm_source=studio</a></p>
<h3 id="檔案下載"><a href="#檔案下載" class="headerlink" title="檔案下載"></a>檔案下載</h3><p>檔案下載: <a href="https://github.com/jinling707/GoogleSignInExample">Download Code</a></p>
<p>登入後進入另一個Activity顯示資料<br>檔案下載: <a href="https://github.com/jinling707/GoogleSignInExample2">Download Code</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android APP Icon規範</title>
    <url>/2021/01/20/Android_APP%20Icon%E8%A6%8F%E7%AF%84/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Android APP的Icon規範</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>本文介紹最基本的Android APP Icon 規格</p>
<p>1 Launcher icon:最基本的app icon，主要在launcher內顯示。</p>
<p>2 Launcher icon（圓形）:可設可不設，不設的話，視launcher而定。</p>
<p>3 Launcher foreground:可自動調整的圖示，讓 launcher 決定 icon 的形狀。由前景與背景組成。(前景圖背景為透明)</p>
<p>4 Launcher background:乘上。</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>AndroidManifest</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line">&lt;/application&gt;</span><br></pre></td></tr></table></figure>
<h4 id="檔案"><a href="#檔案" class="headerlink" title="檔案"></a>檔案</h4><p>調成Project,將以下檔案放入app/src/main/res中</p>
<p><i class="fas fa-folder"></i> mipmap-anydpi-v26</p>
<ul>
<li>ic_launcher.xml</li>
<li>ic_launcher_round.xml</li>
</ul>
<p><i class="fas fa-folder"></i> mipmap-hdpi</p>
<ul>
<li>ic_launcher.png (72*72)</li>
<li>ic_launcher_round.png (72*72)</li>
<li>ic_launcher_foreground.png (162*162)</li>
</ul>
<p><i class="fas fa-folder"></i> mipmap-mdpi</p>
<ul>
<li>ic_launcher.png (48*48)</li>
<li>ic_launcher_round.png (48*48)</li>
<li>ic_launcher_foreground.png (108*108)</li>
</ul>
<p><i class="fas fa-folder"></i> mipmap-xhdpi</p>
<ul>
<li>ic_launcher.png (96*96)</li>
<li>ic_launcher_round.png (96*96)</li>
<li>ic_launcher_foreground.png (216*216)</li>
</ul>
<p><i class="fas fa-folder"></i> mipmap-xxhdpi</p>
<ul>
<li>ic_launcher.png (144*144)</li>
<li>ic_launcher_round.png (144*144)</li>
<li>ic_launcher_foreground.png (324*324)</li>
</ul>
<p><i class="fas fa-folder"></i> mipmap-xxxhdpi</p>
<ul>
<li>ic_launcher.png (192*192)</li>
<li>ic_launcher_round.png (192*192)</li>
<li>ic_launcher_foreground.png (432*432)</li>
</ul>
<h4 id="ic-launcher-xml-與-ic-launcher-round-xml的內容相同"><a href="#ic-launcher-xml-與-ic-launcher-round-xml的內容相同" class="headerlink" title="ic_launcher.xml 與 ic_launcher_round.xml的內容相同"></a>ic_launcher.xml 與 ic_launcher_round.xml的內容相同</h4> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">adaptive-icon</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">background</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@color/noteBG&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreground</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@mipmap/ic_launcher_foreground&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">adaptive-icon</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>圖畫建議用1024*1024px 繪製，畫完可將檔案丟到 <a href="https://appicon.co/">https://appicon.co/</a> 這個網站，該網站會把圖片製成對應的ic_launcher大小，並放入對應的資料夾中。</p>
<p>在繪製ic_launcher_foreground的圖檔時，一定要留邊(用1024*1024px 的畫布繪製時，需畫在以中心為圓心，直徑685px的圓形裡面)</p>
<h3 id="上架"><a href="#上架" class="headerlink" title="上架"></a>上架</h3><p>如果要上架APP到Google Play還需另外準備<br>1 Google Play Icon:不會放進app入面，用於Google Play上架。(512*512)</p>
<p>2 Google Play 主題圖片:不會放進app入面，用於Google Play上架。(1024*500)</p>
<p>3 APP截圖</p>
<p>4 7吋APP截圖</p>
<p>5 10吋APP截圖</p>
<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://medium.com/ericlog/android-app-icon-specification-2e57c96b16b0">https://medium.com/ericlog/android-app-icon-specification-2e57c96b16b0</a></p>
<p>dpi-px-pt-dp-sp教學<br><a href="https://blog.akanelee.me/2018/07/31/dpi-px-pt-dp-sp/">https://blog.akanelee.me/2018/07/31/dpi-px-pt-dp-sp/</a></p>
<head> 
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script> 
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/v4-shims.js"></script> 
</head> 
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>美工</tag>
      </tags>
  </entry>
  <entry>
    <title>Android Gif 使用</title>
    <url>/2021/01/18/Android_Gif%E5%9C%96%E6%AA%94%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>GifImageView、GifImageButton、GifTextureView、GifTextView的使用</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>在gradle(Project)中的repositories加入mavenCentral() (註:共有兩處需要添加)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line"></span><br><span class="line">        mavenCentral() <span class="comment">//添加處</span></span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&quot;com.android.tools.build:gradle:4.0.1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line"></span><br><span class="line">        mavenCentral() <span class="comment">//添加處</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">task <span class="title">clean</span><span class="params">(type: Delete)</span> </span>&#123;</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在gradle(Module:app)中添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">implementation <span class="string">&#x27;pl.droidsonroids.gif:android-gif-drawable:1.1.17&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加後即可使用GifImageView、GifImageButton、GifTextureView、GifTextView</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>activity</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pl.droidsonroids.gif.GifImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">&quot;@drawable/giphy&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://medium.com/@skywing0527/android%E8%87%AA%E5%AD%B8%E7%AD%86%E8%A8%98-15-%E4%BD%BF%E7%94%A8imageview%E6%92%AD%E6%94%BEgif-fb184c2aea56">https://medium.com/@skywing0527/android自學筆記-15-使用imageview播放gif-fb184c2aea56</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>ForegroundService</title>
    <url>/2020/11/13/Android_ForegroundService/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>使用前台服務須創造一通知，讓用戶主動意識到您的應用正在前台執行任務，並且正在消耗系統資源。除非服務已停止或從前台刪除，否則無法取消該通知。</p>
<a id="more"></a>

<p>前台服務的應用示例包括：<br>在前台服務中播放音樂的音樂播放器應用。該通知可能會顯示當前正在播放的歌曲。<br>健身應用程序，在收到用戶的許可後，將其記錄在前台服務中。該通知可能會顯示用戶在當前健身會話期間旅行的距離。</p>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="權限"><a href="#權限" class="headerlink" title="權限"></a>權限</h4><p>Android 9（API級別28）或更高版本，使用必須添加權限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="開啟foreground-service"><a href="#開啟foreground-service" class="headerlink" title="開啟foreground service"></a>開啟foreground service</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,</span><br><span class="line">        <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">Notification notification = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, CHANNEL_ID)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;下拉列表中的Title&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;</span>) <span class="comment">//過多的字以...呈現</span></span><br><span class="line">        <span class="comment">//.setStyle(new NotificationCompat.BigTextStyle().bigText(&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;)) //顯示完整內容</span></span><br><span class="line">        .setSmallIcon(R.drawable.ic_cake)<span class="comment">// 設置狀態攔下小圖標，建議大小為32x32</span></span><br><span class="line">        .setContentIntent(pendingIntent)</span><br><span class="line">        .setLargeIcon(BitmapFactory.decodeResource(getResources(),R.drawable.smile)) <span class="comment">// 設置狀態攔下大圖標，建議用PNG，大小為64x64</span></span><br><span class="line">        .setWhen(System.currentTimeMillis())<span class="comment">// 設置通知發生時間</span></span><br><span class="line">        .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;Stop&quot;</span>, pStopSelf)</span><br><span class="line">        .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;NewActivity&quot;</span>, newActivity)</span><br><span class="line">        .setDefaults(Notification.DEFAULT_ALL) <span class="comment">// 加上提醒效果:震動(DEFAULT_VIBRATE)，音效(DEFAULT_VIBRATE)，燈光(DEFAULT_LIGHT)</span></span><br><span class="line">        <span class="comment">//若有用到震動則需在AndroidManifest.xml加入權限&lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;</span></span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">startForeground(<span class="number">1</span>, notification);</span><br></pre></td></tr></table></figure>
<h4 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h4><p>使用Service需在AndroidManifest.xml加入Service 類別</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;.ForegroundService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.androidforegroundserviceexample;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startService</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Start Foreground Service in Android&quot;</span>);</span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STARTFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        startService(serviceIntent);</span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">// startService(serviceIntent);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopService</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Stop Foreground Service in Android&quot;</span>);</span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        startService(serviceIntent);</span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">//stopService(serviceIntent);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="activity-main"><a href="#activity-main" class="headerlink" title="activity_main"></a>activity_main</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonStartService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Start Service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;startService&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonStopService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Stop Service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;stopService&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ForegroundService"><a href="#ForegroundService" class="headerlink" title="ForegroundService"></a>ForegroundService</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.androidforegroundserviceexample;</span><br><span class="line"><span class="keyword">import</span> android.app.Notification;</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationChannel;</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationManager;</span><br><span class="line"><span class="keyword">import</span> android.app.PendingIntent;</span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForegroundService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Log.v(<span class="string">&quot;ForegroundService&quot;</span>,<span class="string">&quot;onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通知跳轉業面</span></span><br><span class="line">        PendingIntent newActivity = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>, NewActivity.class), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通知關閉Service</span></span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Stop Foreground Service in Android&quot;</span>);</span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        PendingIntent pStopSelf = PendingIntent.getService(<span class="keyword">this</span>, <span class="number">0</span>, serviceIntent, PendingIntent.FLAG_CANCEL_CURRENT);</span><br><span class="line">      </span><br><span class="line">        <span class="comment">/************************/</span></span><br><span class="line">        String input = intent.getStringExtra(<span class="string">&quot;inputExtra&quot;</span>);</span><br><span class="line">        Log.v(<span class="string">&quot;ForegroundService&quot;</span> , input);</span><br><span class="line"></span><br><span class="line">        Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,</span><br><span class="line">                <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        Notification notification = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, CHANNEL_ID)</span><br><span class="line">                .setContentTitle(<span class="string">&quot;下拉列表中的Title&quot;</span>)</span><br><span class="line">                .setContentText(<span class="string">&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;</span>) <span class="comment">//過多的字以...呈現</span></span><br><span class="line">                <span class="comment">//.setStyle(new NotificationCompat.BigTextStyle().bigText(&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;)) //顯示完整內容</span></span><br><span class="line">                .setSmallIcon(R.drawable.ic_cake)<span class="comment">// 設置狀態攔下小圖標，建議大小為32x32</span></span><br><span class="line">                .setContentIntent(pendingIntent)</span><br><span class="line">                .setLargeIcon(BitmapFactory.decodeResource(getResources(),R.drawable.smile)) <span class="comment">// 設置狀態攔下大圖標，建議用PNG，大小為64x64</span></span><br><span class="line">                .setWhen(System.currentTimeMillis())<span class="comment">// 設置通知發生時間</span></span><br><span class="line">                .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;Stop&quot;</span>, pStopSelf)</span><br><span class="line">                .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;NewActivity&quot;</span>, newActivity)</span><br><span class="line">                .setDefaults(Notification.DEFAULT_ALL) <span class="comment">// 加上提醒效果:震動(DEFAULT_VIBRATE)，音效(DEFAULT_VIBRATE)，燈光(DEFAULT_LIGHT)</span></span><br><span class="line">                <span class="comment">//若有用到震動則需在AndroidManifest.xml加入權限&lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        <span class="keyword">if</span> (intent.getAction().equals( <span class="string">&quot;STARTFOREGROUND_ACTION&quot;</span>)) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;ForegroundService&quot;</span>, <span class="string">&quot;Received Start Foreground Intent &quot;</span>);</span><br><span class="line">            startForeground(<span class="number">1</span>, notification);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (intent.getAction().equals( <span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>)) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;ForegroundService&quot;</span>, <span class="string">&quot;Received Stop Foreground Intent&quot;</span>);</span><br><span class="line">            stopForeground(<span class="keyword">true</span>);</span><br><span class="line">            stopSelfResult(startId);</span><br><span class="line">            <span class="comment">//stopSelf();//停止Service</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">// startForeground(1, notification);</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> START_NOT_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>onStartCommand() 的回傳值決定 Service 被殺掉時要怎麼做對應的處理:<br>START_NOT_STICKY：如果系統在 onStartCommand() 後終止 Service，除非有待決的 intent 要傳送，否則請「不要」建立 Service。<br>START_STICKY：如果系統在 onStartCommand() 後終止 Service，請重新建立 Service 並呼叫 onStartCommand()，但「不要」重新傳送最後的 intent。 相反地，除非有待決的 intent 要啟動 service，否則系統會使用 null intent 呼叫，適用於媒體播放程式 。<br>START_REDELIVER_INTENT：如果系統在 onStartCommand() 後終止 Service，請重新建立 Service 並使用傳送至 Service的最後 intent 呼叫onStartCommand()。適用的 Service 為主動執行如下載檔案等應該立即繼續的工作。</p>
<p>PendingIntent有以下flag：<br>FLAG_CANCEL_CURRENT:如果當前系統中已經存在一個相同的PendingIntent對象，那麼就將先將已有的PendingIntent取消，然後重新生成一個PendingIntent對象。<br>FLAG_NO_CREATE:如果當前系統中不存在相同的PendingIntent對象，系統將不會創建該PendingIntent對象而是直接返回null。<br>FLAG_ONE_SHOT:該PendingIntent只作用一次。<br>FLAG_UPDATE_CURRENT:如果系統中已存在該PendingIntent對象，那麼系統將保留該PendingIntent對象，但是會使用新的Intent來更新之前PendingIntent中的Intent對像數據，例如更新Intent中的Extras。<br>創建PendingIntent方式：<br>PendingIntent.getActivity (context, requestCode, broadIntent, flags)<br>PendingIntent.getBroadcast(context,requestCode, broadIntent, flags)<br>PendingIntent.getService (context, requestCode, broadIntent, flags)</p>
<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔<br><a href="https://developer.android.com/guide/components/foreground-services">https://developer.android.com/guide/components/foreground-services</a><br>Foreground Service<br><a href="https://androidwave.com/foreground-service-android-example/">https://androidwave.com/foreground-service-android-example/</a><br>PendingIntent<br><a href="https://blog.csdn.net/yangwen123/article/details/8019739">https://blog.csdn.net/yangwen123/article/details/8019739</a></p>
<h3 id="檔案下載"><a href="#檔案下載" class="headerlink" title="檔案下載"></a>檔案下載</h3><p>檔案下載: <a href="https://github.com/jinling707/AndroidForegroundServiceExample">Download Code</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android Service</tag>
      </tags>
  </entry>
  <entry>
    <title>Android_MVVM基本使用</title>
    <url>/2020/11/30/Android_MVVM%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>基本MVVM架構(含ViewMode、DataBinding)</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>MVVM是Model-View-ViewModel的簡稱，三者扮演的角色為：</p>
<p>Model：管理專案的資料來源，如API、資料庫和SharedPreference等，並回應來自ViewModel的資料請求。<br>View：可以是Activity、Fragment或custom view，用來顯示UI和監聽使用者動作。當使用者跟UI有互動時，會將指令傳給ViewModel，透過ViewModel來獲得所需的資料並顯示。<br>ViewModel：接收View的指令並對Model請求資料給View使用。</p>
<h4 id="ViewModel中的3種資料儲存"><a href="#ViewModel中的3種資料儲存" class="headerlink" title="ViewModel中的3種資料儲存"></a>ViewModel中的3種資料儲存</h4><p>1.SavedState:可在資料改變時，即時顯示在View上，並保護資料不會因為進入後台而消失。(註:若是再有多個Fragment要使用SavedState，可以將其全寫在Fragment們的Activity中)</p>
<p>2.LiveData:可在資料改變時，即時顯示在View上。</p>
<p>3.一般:直接在ViewModel中宣告即可使用</p>
<img src="/img/ViewModel生命週期.png" width="350px" />  

<p>基本上，ViewModel不會因為進入後台便被銷毀，但在程式擱置過久、空間不夠，或手機設定上不允許程式進入後台活動，ViewModel便會被銷毀。雖然隨著Activity的重建，ViewModel亦可以跟著重建，不過重建後資料都會消失。</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="Module-gradle-添加依賴"><a href="#Module-gradle-添加依賴" class="headerlink" title="Module gradle 添加依賴"></a>Module gradle 添加依賴</h4><p>dependencies</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ViewModel</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.lifecycle:lifecycle-extensions:2.2.0&#x27;</span></span><br><span class="line"><span class="comment">//SavedState</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.lifecycle:lifecycle-viewmodel-savedstate:1.0.0-alpha01&#x27;</span></span><br></pre></td></tr></table></figure>
<p>defaultConfig</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//DataBinding</span></span><br><span class="line">dataBinding&#123; enabled <span class="keyword">true</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MyViewModel-java"><a href="#MyViewModel-java" class="headerlink" title="MyViewModel.java"></a>MyViewModel.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.MutableLiveData;</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.SavedStateHandle;</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.ViewModel;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**SavedState*/</span></span><br><span class="line">    <span class="comment">//  使用SavedState需添加  implementation &#x27;androidx.lifecycle:lifecycle-viewmodel-savedstate:1.0.0&#x27;</span></span><br><span class="line">    <span class="keyword">private</span> SavedStateHandle handle;</span><br><span class="line">    <span class="comment">//ViewModel的建構子需傳送SavedStateHandle</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewModel</span><span class="params">(SavedStateHandle handle)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handle = handle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取得SavedStateNumber</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MutableLiveData&lt;Integer&gt; <span class="title">getSavedState_Number</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!handle.contains(MainActivity.SavedState_Number))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//初始化</span></span><br><span class="line">            handle.set(MainActivity.SavedState_Number,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  handle.getLiveData(MainActivity.SavedState_Number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**LiveData*/</span></span><br><span class="line">    <span class="keyword">private</span> MutableLiveData&lt;Integer&gt; LiveData_Number;</span><br><span class="line">    <span class="comment">//取得LiveData</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MutableLiveData&lt;Integer&gt; <span class="title">getLiveData_Number</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(LiveData_Number == <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            LiveData_Number = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line">            LiveData_Number.setValue(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> LiveData_Number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**一般資料*/</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; List0 = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作SavedState</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSavedStateNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        getSavedState_Number().setValue(getSavedState_Number().getValue()+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//操作LiveData</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLiveDataNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        getLiveData_Number().setValue(getLiveData_Number().getValue()+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="MainActivity-java"><a href="#MainActivity-java" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.databinding.DataBindingUtil;</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.SavedStateViewModelFactory;</span><br><span class="line"><span class="keyword">import</span> androidx.lifecycle.ViewModelProvider;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> com.example.viewmodelrestore.databinding.ActivityMainBinding;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用DataBinding 需要再Gradle(app) android defaultConfig 裡添加 dataBinding&#123; enabled true&#125;</span></span><br><span class="line"><span class="comment">//並到Activity按小燈泡 將其轉換為BundingStyle</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    MyViewModel myViewModel;</span><br><span class="line">    ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SavedState的KEY(字串)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String SavedState_Number = <span class="string">&quot;my_number&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//setContentView(R.layout.activity_main);這行就不用了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ViewModel</span></span><br><span class="line">        myViewModel =  <span class="keyword">new</span> ViewModelProvider(<span class="keyword">this</span>,<span class="keyword">new</span> SavedStateViewModelFactory(getApplication(), <span class="keyword">this</span>))</span><br><span class="line">                .get(MyViewModel.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        儲存ViewModel資料不背後台殺掉的舊方法</span></span><br><span class="line"><span class="comment">//        myViewModel = ViewModelProviders.of(this).get(MyViewModel.class);</span></span><br><span class="line"><span class="comment">//        if(savedInstanceState != null ) //儲存ViewModel方法一  舊方法 第一次開啟時會等於空</span></span><br><span class="line"><span class="comment">//        &#123;</span></span><br><span class="line"><span class="comment">//            myViewModel.getNumber().setValue(savedInstanceState.getInt(KEY_NUMBER));</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//DataBinding</span></span><br><span class="line">        binding = DataBindingUtil.setContentView(<span class="keyword">this</span>,R.layout.activity_main);</span><br><span class="line">        binding.setData(myViewModel);</span><br><span class="line">        binding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">/**呼叫|Activity元件*/</span></span><br><span class="line">        <span class="comment">//binding.tv</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 儲存ViewModel資料不背後台殺掉的舊方法</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    protected void onSaveInstanceState(@NonNull Bundle outState)//儲存ViewModel方法一  舊方法: 後臺如果沒有辦法保存ViewModel時 用這保存</span></span><br><span class="line"><span class="comment">//    &#123;</span></span><br><span class="line"><span class="comment">//        super.onSaveInstanceState(outState);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        outState.putInt(KEY_NUMBER,myViewModel.getNumber().getValue());</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="activity-main-xml"><a href="#activity-main-xml" class="headerlink" title="activity_main.xml"></a>activity_main.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;data&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.example.viewmodelrestore.MyViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#c5d3a7&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;SavedStateData&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;30dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">&quot;@drawable/textview_bg&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;@&#123;String.valueOf(data.savedState_Number)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.272&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;()-&gt;data.addSavedStateNumber()&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;+1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.368&quot;</span> /&gt;</span></span><br><span class="line">            /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#d3a7bd&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;LiveData&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;30dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv2&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">&quot;@drawable/textview_bg&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;@&#123;String.valueOf(data.getLiveData_Number())&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.272&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/button2&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;()-&gt;data.addLiveDataNumber()&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">&quot;+1&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.368&quot;</span> /&gt;</span></span><br><span class="line">            /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="textview-bg-xml-res-drawable"><a href="#textview-bg-xml-res-drawable" class="headerlink" title="textview_bg.xml  (res/drawable)"></a>textview_bg.xml  (res/drawable)</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;#FFFFFF&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;10dp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">stroke</span> <span class="attr">android:width</span>=<span class="string">&quot;3dp&quot;</span> <span class="attr">android:color</span>=<span class="string">&quot;#728ea3&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://www.youtube.com/watch?v=uonkx0G2lng&amp;list=PLPh5-KovAYtFyX5elSTT9wEMt0HxMhR7L&amp;index=14">https://www.youtube.com/watch?v=uonkx0G2lng&amp;list=PLPh5-KovAYtFyX5elSTT9wEMt0HxMhR7L&amp;index=14</a></p>
<h3 id="檔案下載"><a href="#檔案下載" class="headerlink" title="檔案下載"></a>檔案下載</h3><p>檔案下載: <a href="https://github.com/jinling707/ViewModelExample">Download Code</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android Permission</title>
    <url>/2020/11/17/Android_Permission/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>權限的目的是保護Android用戶的隱私。<br>在Android6 sdk23 以上要求使用。</p>
<a id="more"></a>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="普通權限"><a href="#普通權限" class="headerlink" title="普通權限"></a>普通權限</h4><p>對用戶的隱私或其他應用的操作風險很小。需在Manifest聲明，但不需詢問使用者同意便可使用。</p>
<h4 id="危險權限"><a href="#危險權限" class="headerlink" title="危險權限"></a>危險權限</h4><p>需要涉及用戶私人信息、數據或資源的區域，或可能影響用戶存儲的數據，或是其他應用程序的操作。需在Manifest聲明，且需詢問使用者的同意才可使用。</p>
<h5 id="危險權限-權限組"><a href="#危險權限-權限組" class="headerlink" title="危險權限-權限組"></a>危險權限-權限組</h5><p>所有危險的 Android 系統權限都屬於權限組。<br>向用戶要求權限的對話框不會描述該具體權限，例如，如果應用請求 READ_CONTACTS 權限，系統對話框只說明該應用需要訪問設備的聯繫信息。而在該權限組中，只要有其中一權限被使用者允許，則該權限組的所有權限皆視為允許。</p>
<p>權限組查詢<br><a href="https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#%E6%9D%83%E9%99%90%E7%BA%A7%E5%88%AB">https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#%E6%9D%83%E9%99%90%E7%BA%A7%E5%88%AB</a><br>權限說明<br><a href="https://developer.android.com/reference/android/Manifest.permission#SMS_FINANCIAL_TRANSACTIONS">https://developer.android.com/reference/android/Manifest.permission#SMS_FINANCIAL_TRANSACTIONS</a></p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="聲明權限"><a href="#聲明權限" class="headerlink" title="聲明權限"></a>聲明權限</h4><p>AndroidManifest</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//定位權限組</span><br><span class="line">//網路定位</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line">//GPS</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">//訊息權限組</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECEIVE_SMS&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_SMS&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_SMS&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="檢查、要求權限"><a href="#檢查、要求權限" class="headerlink" title="檢查、要求權限"></a>檢查、要求權限</h4><h5 id="檢查權限"><a href="#檢查權限" class="headerlink" title="檢查權限:"></a>檢查權限:</h5><p>ContextCompat.checkSelfPermission(context, Manifest.permission.權限名)<br>回傳-1:不允許此權限<br>回傳0:允許此權限</p>
<h5 id="要求權限"><a href="#要求權限" class="headerlink" title="要求權限:"></a>要求權限:</h5><p>this.requestPermissions(new String[]{Manifest.permission.權限名}, requestCode);</p>
<h5 id="兩個以上權限組的範例"><a href="#兩個以上權限組的範例" class="headerlink" title="兩個以上權限組的範例:"></a>兩個以上權限組的範例:</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.RECEIVE_SMS) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) <span class="comment">// 判斷裝置版本是否大於SDK23</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.RECEIVE_SMS&#125;, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同一權限組的只需派一代表檢查與對其進行權限要求即可。</p>
<h4 id="權限要求對話框的互動結果"><a href="#權限要求對話框的互動結果" class="headerlink" title="權限要求對話框的互動結果"></a>權限要求對話框的互動結果</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">       <span class="keyword">if</span> (requestCode == <span class="number">1</span>)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (grantResults[<span class="number">0</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">               Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕Location權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (grantResults[<span class="number">1</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">               Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕SMS權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>註:後面的Toast指令會覆蓋掉前面的</p>
<h3 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h3><p>使用者若是多次拒絕權限對話框的詢問或是對此權限勾選”不再詢問”，會導致requestPermissions將不再工作(用shouldShowRequestPermissionRationale來判斷)。<br>此時可將使用者導到APP設定畫面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//裝置未授予此權限，且拒絕被訪問權限，直接導到設定頁面</span></span><br><span class="line"><span class="keyword">if</span>(!ActivityCompat.shouldShowRequestPermissionRationale(MainActivity.<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION ) &amp;&amp;</span><br><span class="line">        ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line">    openAppSettingsIntent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>shouldShowRequestPermissionRationale:<br>回傳true(允許說明) 1.請求權限被禁止，但未選擇【不再提醒】<br>回傳false(不須再說明–&gt;無法使用requestPermissions):1.第一次請求權限時 2.使用者堅決不給權限，已勾選別再詢問我  3.已允許權限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openAppSettingsIntent</span><span class="params">()</span><span class="comment">//前往系統設定頁面</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="comment">//因無法直接導到「權限」選單裡，只能到應用程式資訊頁面 --&gt;ACTION_APPLICATION_DETAILS_SETTINGS</span></span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.fromParts(<span class="string">&quot;package&quot;</span>, getPackageName(), <span class="keyword">null</span>));</span><br><span class="line">    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.ActivityCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.ContextCompat;</span><br><span class="line"><span class="keyword">import</span> android.Manifest;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.RECEIVE_SMS) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) <span class="comment">// 判斷裝置版本是否大於SDK23</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.RECEIVE_SMS&#125;, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//裝置未授予此權限，且拒絕被訪問權限，直接導到設定頁面</span></span><br><span class="line">        <span class="keyword">if</span>(!ActivityCompat.shouldShowRequestPermissionRationale(MainActivity.<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION ) &amp;&amp;</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED</span><br><span class="line">        )</span><br><span class="line">        &#123;</span><br><span class="line">            openAppSettingsIntent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**shouldShowRequestPermissionRationale</span></span><br><span class="line"><span class="comment">         * 回傳true(允許說明) 1.請求權限被禁止，但未選擇【不再提醒】</span></span><br><span class="line"><span class="comment">         * 回傳false(不須再說明--&gt;無法使用requestPermissions):1.第一次請求權限時 2.使用者堅決不給權限，已勾選別再詢問我  3.已允許權限</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">        <span class="keyword">if</span> (requestCode == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">0</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕Location權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">1</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕SMS權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openAppSettingsIntent</span><span class="params">()</span><span class="comment">//前往系統設定頁面</span></span></span><br><span class="line"><span class="function">    </span>&#123;   <span class="comment">//無法直接導到「權限」選單裡，只能到應用程式資訊頁面 --&gt;ACTION_APPLICATION_DETAILS_SETTINGS</span></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.fromParts(<span class="string">&quot;package&quot;</span>, getPackageName(), <span class="keyword">null</span>));</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔<br><a href="https://developer.android.com/guide/topics/permissions/overview">https://developer.android.com/guide/topics/permissions/overview</a><br>官方範例<br><a href="https://developer.android.com/training/permissions/requesting">https://developer.android.com/training/permissions/requesting</a><br>範例<br><a href="https://myapollo.com.tw/zh-tw/polly-android-runtime-permissions/">https://myapollo.com.tw/zh-tw/polly-android-runtime-permissions/</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android SdkVersion</title>
    <url>/2020/11/17/Android_SdkVersion/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>介紹minSdkVersion、compileSdkVersion、targetSdkVersion<br>可通過API的級別來表示應用程序與Android平台的一個或多個版本的兼容性</p>
<a id="more"></a>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="minSdkVersion"><a href="#minSdkVersion" class="headerlink" title="minSdkVersion"></a>minSdkVersion</h4><p>App最小可以支援的版本。(可由Android Studio查詢現有行動裝置的版本比例，藉此確定使用minSdkVersion級別)<br>在Play Store中，用戶的裝置版本若小於APP的minSdkVersion，那Play Store便不向該用戶顯示此App。</p>
<p>在開發時，會依minSdkVersion來警告你，是否用了高於minSdkVersion的API，避免調用不存在的API，造成運行問題。</p>
<h4 id="compileSdkVersion"><a href="#compileSdkVersion" class="headerlink" title="compileSdkVersion"></a>compileSdkVersion</h4><p>Gradle用的AndroidSDK編譯版本。<br>官方強烈推薦用最新的SDK進行編譯<br>(在開發中的應用程式，提醒已棄用的API，也為使用新的API做好準備)</p>
<h4 id="targetSdkVersion"><a href="#targetSdkVersion" class="headerlink" title="targetSdkVersion"></a>targetSdkVersion</h4><p>App最合適的版本，最低通常須依Googlee規定<br>也是向前兼容的主要依據:如果裝置API級別高於您的應用程序聲明的targetSdkVersion，則係統可能會啟用兼容性行為，以確保您的應用程序繼續按您期望的方式運行。<br>舉例:<br>在Android 6.0（API 级别23）及更高版本中，使用一些相對敏感的權限時，需要徵求用戶的許可。<br>若target sdk &lt; 23 ，Android 則會自動用 23 以下的 api 運行，而若是APP運行在android 6.0或以上版本，且target sdk&gt;=23，便需要向其徵求敏感權限的使用。</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="設定位置"><a href="#設定位置" class="headerlink" title="設定位置"></a>設定位置</h4><p>build.gradle</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">30</span></span><br><span class="line">    buildToolsVersion <span class="string">&quot;30.0.1&quot;</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.xxx.xxx&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">18</span></span><br><span class="line">        targetSdkVersion <span class="number">26</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="版本判斷及應變"><a href="#版本判斷及應變" class="headerlink" title="版本判斷及應變"></a>版本判斷及應變</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) </span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔 <a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element">https://developer.android.com/guide/topics/manifest/uses-sdk-element</a><br><a href="https://willy2016.pixnet.net/blog/post/215759103">https://willy2016.pixnet.net/blog/post/215759103</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>SharedPreferences</title>
    <url>/2020/11/17/Android_SharedPreferences/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>儲存簡單資料<br>例如：帳號資料、遊戲關卡、APP喜愛設定等</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>資料儲存在手機中APP的一個專用目錄下(每個APP都會有一個專用目錄):<br>data/data/[package.name]/shared_prefs/[name.xml]</p>
<p>EX:data/data/com.example.sharepreferences/shared_prefs/myData.xml<br>該檔案可在Android Studio中的Device File Explore中察看</p>
<p>資料儲存格式為XML檔</p>
<p>若使用者在設定中清除APP 儲存空間，則SharedPreferences所存的檔案會被清空(為Android本地資料)</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="創建"><a href="#創建" class="headerlink" title="創建"></a>創建</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SharedPreferences shp = getSharedPreferences(檔案名稱,Context.MODE_PRIVATE);</span><br></pre></td></tr></table></figure>

<p>若沒指定存檔名稱，默認為該Activity的名字</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SharedPreferences shp = getPreferences(Context.MODE_PRIVATE);</span><br></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>Value</th>
<th>Constant</th>
<th>說明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>MODE_PRIVATE</td>
<td>常用，只允許該 APP 存取</td>
</tr>
<tr>
<td>1</td>
<td>MODE_WORLD_READABLE</td>
<td>不建議，所有 APP 都能讀取</td>
</tr>
<tr>
<td>2</td>
<td>MODE_WORLD_WRITEABLE</td>
<td>不建議，所有 APP 都能存取、寫入</td>
</tr>
<tr>
<td>4</td>
<td>MODE_MULTI_PROCESS</td>
<td>允許多個 process 同時存取</td>
</tr>
</tbody></table>
<h4 id="寫入範例"><a href="#寫入範例" class="headerlink" title="寫入範例"></a>寫入範例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">set.add(<span class="string">&quot;秋天&quot;</span>);</span><br><span class="line">set.add(<span class="string">&quot;冬天&quot;</span>);</span><br><span class="line"></span><br><span class="line">SharedPreferences shp = getSharedPreferences(<span class="string">&quot;MyData&quot;</span>,Context.MODE_PRIVATE);</span><br><span class="line">SharedPreferences.Editor editor = shp.edit();</span><br><span class="line"></span><br><span class="line">editor.putInt(<span class="string">&quot;NUMBER&quot;</span>,<span class="number">900</span>);</span><br><span class="line">editor.putString(<span class="string">&quot;USER&quot;</span>, <span class="string">&quot;Boyd&quot;</span>);</span><br><span class="line">editor.putFloat(<span class="string">&quot;WEIGHT&quot;</span>, <span class="number">55</span>);</span><br><span class="line">editor.putStringSet(<span class="string">&quot;SEASON&quot;</span>, set);</span><br><span class="line">editor.apply();</span><br></pre></td></tr></table></figure>

<p>editor.apply()為非同步，可避免衝突<br>editor.commit()亦可，不過可能會產生碰撞</p>
<h4 id="讀取範例"><a href="#讀取範例" class="headerlink" title="讀取範例"></a>讀取範例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SharedPreferences shp = getSharedPreferences(<span class="string">&quot;MyData&quot;</span>,Context.MODE_PRIVATE);</span><br><span class="line"></span><br><span class="line">String USER = shp.getString(<span class="string">&quot;USER&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">int</span> x = shp.getInt(<span class="string">&quot;NUMBER&quot;</span>,<span class="number">0</span>);</span><br><span class="line">Set&lt;String&gt; set2  = shp.getStringSet(<span class="string">&quot;SEASON&quot;</span>, <span class="keyword">new</span> HashSet&lt;String&gt;());</span><br></pre></td></tr></table></figure>



<h4 id="寫成Class"><a href="#寫成Class" class="headerlink" title="寫成Class"></a>寫成Class</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.sharepreferences;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.SharedPreferences;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyData</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyData</span><span class="params">(Context context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveInt</span><span class="params">(String fileName,String key,<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SharedPreferences shp = context.getSharedPreferences(fileName,Context.MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = shp.edit();</span><br><span class="line">        editor.putInt(key,value);</span><br><span class="line">        editor.apply();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loadInt</span><span class="params">(String fileName,String key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SharedPreferences shp = context.getSharedPreferences(fileName,Context.MODE_PRIVATE);</span><br><span class="line">        <span class="keyword">int</span> x =shp.getInt(key,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveString</span><span class="params">(String fileName,String key,String value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SharedPreferences shp = context.getSharedPreferences(fileName,Context.MODE_PRIVATE);</span><br><span class="line">        SharedPreferences.Editor editor = shp.edit();</span><br><span class="line">        editor.putString(key,value);</span><br><span class="line">        editor.apply();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">loadString</span><span class="params">(String fileName,String key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SharedPreferences shp = context.getSharedPreferences(fileName,Context.MODE_PRIVATE);</span><br><span class="line">        String s =shp.getString(key,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>寫入、讀取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MyData myData = <span class="keyword">new</span> MyData(getApplicationContext()); <span class="comment">//不能傳遞this</span></span><br><span class="line">myData.saveInt(<span class="string">&quot;Money&quot;</span>,<span class="string">&quot;May&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">myData.saveString(<span class="string">&quot;Money&quot;</span>,<span class="string">&quot;Date&quot;</span>,<span class="string">&quot;2020-05-11&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Money = myData.loadInt(<span class="string">&quot;Money&quot;</span>,<span class="string">&quot;May&quot;</span>);</span><br><span class="line">String Date = myData.loadString(<span class="string">&quot;Money&quot;</span>,<span class="string">&quot;Date&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>getApplicationContext():返回該應用程式的上下文,生命週期是整個應用,應用摧毀它才摧毀。<br>Activity.this:返回當前Activity的上下文,生命週期只是它所在的Activity,Activity 摧毀他就摧毀</p>
<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>SharedPreferences <a href="https://spicyboyd.blogspot.com/2018/04/appandroid-sharedpreferences.html">https://spicyboyd.blogspot.com/2018/04/appandroid-sharedpreferences.html</a><br>Activity.this和getApplicationContext()的區別 <a href="https://www.itread01.com/p/57587.html">https://www.itread01.com/p/57587.html</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android檔案資料存取</tag>
      </tags>
  </entry>
  <entry>
    <title>Android TextView元件滑動</title>
    <url>/2021/06/06/Android_TextView%E5%85%83%E4%BB%B6%E6%BB%91%E5%8B%95/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Android TextView元件滑動使用方法</p>
<a id="more"></a>

<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--    width和height要固定，不要用wrap_content，會出現null object reference的問題--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/TV&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scrollbars</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fadeScrollbars</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#ffffff&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">textView = findViewById(R.id.TV);</span><br><span class="line"><span class="comment">// 使TextView內容區可以滚动</span></span><br><span class="line">textView.setMovementMethod(ScrollingMovementMethod.getInstance());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//TextView顯示併下拉到最下面</span></span><br><span class="line">textView.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//將內容接續在其後</span></span><br><span class="line">        textView.append(Data);</span><br><span class="line">        <span class="comment">//計算出最內容最下面的位置</span></span><br><span class="line">        <span class="keyword">int</span> scrollAmount = textView.getLayout().getLineTop(textView.getLineCount()) - textView.getHeight();</span><br><span class="line">        <span class="comment">//移動到最下面位置</span></span><br><span class="line">        <span class="keyword">if</span> (scrollAmount &gt; <span class="number">0</span>)</span><br><span class="line">            textView.scrollTo(<span class="number">0</span>, scrollAmount);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            textView.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://blog.csdn.net/u014341735/article/details/78425437">https://blog.csdn.net/u014341735/article/details/78425437</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android_UDP_Client</title>
    <url>/2021/06/06/Android_UDP_Client/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>UDP客戶端，包含發送與接收</p>
<a id="more"></a>

<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>權限</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Port 和 IP</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEST_PORT = <span class="number">30055</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEST_IP = <span class="string">&quot;192.168.1.236&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每筆數據傳送大小為4KB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DATA_LEN = <span class="number">4096</span>;</span><br><span class="line"></span><br><span class="line">    String TAG = <span class="string">&quot;UDP_Client&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接收數據的大小</span></span><br><span class="line">                <span class="keyword">byte</span>[] inBuff = <span class="keyword">new</span> <span class="keyword">byte</span>[DATA_LEN];</span><br><span class="line">                <span class="comment">// 創建DatagramPacket來接收數據</span></span><br><span class="line">                DatagramPacket inPacket = <span class="keyword">new</span> DatagramPacket(inBuff, inBuff.length);</span><br><span class="line">                <span class="comment">// 創建DatagramPacket來發送數據</span></span><br><span class="line">                DatagramPacket outPacket = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> (</span><br><span class="line">                        <span class="comment">// 創建一個DatagramSocket各戶端，使用随機端口</span></span><br><span class="line">                        DatagramSocket socket = <span class="keyword">new</span> DatagramSocket()) &#123;</span><br><span class="line">                    <span class="comment">/***發送***/</span></span><br><span class="line">                    <span class="comment">//初始化發送用的DatagramSocket(它包含一個長度為0的字節數組)</span></span><br><span class="line">                    outPacket = <span class="keyword">new</span> DatagramPacket(<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>], <span class="number">0</span>, InetAddress.getByName(DEST_IP), DEST_PORT);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//要發送的內容</span></span><br><span class="line">                    String sendData = <span class="string">&quot;sendData&quot;</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">byte</span>[] buff = sendData.getBytes();</span><br><span class="line">                    outPacket.setData(buff);</span><br><span class="line">                    socket.send(outPacket);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/***讀取***/</span></span><br><span class="line">                    <span class="comment">// 讀取Socket中的數據。將讀到的數據放在inPacket封裝的字節數組中。</span></span><br><span class="line">                    socket.receive(inPacket);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//讀取到的內容</span></span><br><span class="line">                    String recieveData = <span class="keyword">new</span> String(inBuff, <span class="number">0</span>, inPacket.getLength());</span><br><span class="line">                    Log.v(TAG, <span class="string">&quot;recieveData:&quot;</span> + <span class="keyword">new</span> String(inBuff, <span class="number">0</span>, inPacket.getLength()));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    Log.e(TAG, e.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>activity_main.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;send&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;傳送&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://blog.csdn.net/jiangxinyu/article/details/8161044">https://blog.csdn.net/jiangxinyu/article/details/8161044</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android_定位位置擷取</title>
    <url>/2021/06/06/Android_%E5%AE%9A%E4%BD%8D%E4%BD%8D%E7%BD%AE%E6%93%B7%E5%8F%96/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>GPS定位、網路定位</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>GPS定位較網路定位來得精確，不過只適用於室外。<br>在室內可用網路定位來獲取位置(記得開啟網路)。</p>
<p>GPS定位:透過GPS(全球定位系統)及 Wi-Fi 和行動數據來盡可能的判斷精確位置。<br>網路定位:允許 API 使用 Wi-Fi 或行動數據來判斷裝置的位置。傳回的位置其準確度大約是以城市街區為單位。</p>
<p>註:如果一直抓不到網路定位，可先開啟GoogleMap定位一下自己的位置再試試。</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="權限"><a href="#權限" class="headerlink" title="權限"></a>權限</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- GPS精確定位 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Wi-Fi 或行動數據約略定位 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uses-permission</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="範例-1"><a href="#範例-1" class="headerlink" title="範例"></a>範例</h4><p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.ContextCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.Manifest;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</span><br><span class="line"><span class="keyword">import</span> android.location.Location;</span><br><span class="line"><span class="keyword">import</span> android.location.LocationManager;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView textView;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        textView = findViewById(R.id.TV);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//位置權限</span></span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED</span><br><span class="line">        ) &#123;</span><br><span class="line"></span><br><span class="line">            requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.ACCESS_COARSE_LOCATION&#125;, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//開啟定位</span></span><br><span class="line">        LocationManager mLocationManager = (LocationManager) getSystemService(LOCATION_SERVICE);</span><br><span class="line">        <span class="keyword">if</span> (mLocationManager.isProviderEnabled(LocationManager.GPS_PROVIDER) || mLocationManager.isProviderEnabled(LocationManager.NETWORK_PROVIDER)) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            startActivity(<span class="keyword">new</span> Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="meta">@NonNull</span> String[] permissions, <span class="meta">@NonNull</span> <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (requestCode == <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED &amp;&amp; grantResults[<span class="number">1</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getLocation</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//取得位置</span></span><br><span class="line">        <span class="keyword">double</span> latitude = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">double</span> longitude = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">        String Tag = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        LocationManager mLocationManager = (LocationManager) <span class="keyword">this</span>.getSystemService(LOCATION_SERVICE);</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Location location = mLocationManager.getLastKnownLocation(LocationManager.GPS_PROVIDER);</span><br><span class="line">            Tag = <span class="string">&quot;GPS定位&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (location == <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                location = mLocationManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);</span><br><span class="line">                Tag = <span class="string">&quot;NETWORK定位&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (location != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//緯度</span></span><br><span class="line">                latitude = Double.valueOf(<span class="keyword">new</span> java.text.DecimalFormat(<span class="string">&quot;#.000000&quot;</span>).format(location.getLatitude()));</span><br><span class="line">                <span class="comment">//經度</span></span><br><span class="line">                longitude = Double.valueOf(<span class="keyword">new</span> java.text.DecimalFormat(<span class="string">&quot;#.000000&quot;</span>).format(location.getLongitude()));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Tag = <span class="string">&quot;無定位資料&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            textView.setText(Tag+<span class="string">&quot;　&quot;</span>+<span class="string">&quot;E&quot;</span> + longitude+<span class="string">&quot; &quot;</span>+<span class="string">&quot;N&quot;</span> + latitude);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>activity_main.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/TV&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;獲取位置&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;getLocation&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://ithelp.ithome.com.tw/articles/10250692">https://ithelp.ithome.com.tw/articles/10250692</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Android檔案存取-SdCard</title>
    <url>/2020/11/30/Android_%E6%AA%94%E6%A1%88%E5%AD%98%E5%8F%96-SdCard/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Android裡SdCard的檔案儲存(內存與外存)</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h3 id="SdCard外存"><a href="#SdCard外存" class="headerlink" title="SdCard外存"></a>SdCard外存</h3><p>資料儲存在SdCard裡。<br>即使使用者在設定中清除該APP 儲存空間，儲存在SdCard外存裡的資料也不會被影響。</p>
<p>Environment.getExternalStorageDirectory().getAbsolutePath()方法可查詢SdCard檔案存取的位置。不過礙於權限看不到。</p>
<p>SdCard外存的資料可在sdcard資料夾中查看到。(可在Android Studio中的Device File Explore中察看)<br>(sdcard/[file_name.*])</p>
<h4 id="SdCard內存"><a href="#SdCard內存" class="headerlink" title="SdCard內存"></a>SdCard內存</h4><p>資料儲存在SdCard裡，該專案的資料夾中。<br>若使用者在設定中清除APP 儲存空間，該專案SdCard內存資料會一同被清空。</p>
<p>Environment.getExternalStorageDirectory().getAbsolutePath()方法可查詢SdCard檔案存取的位置。不過礙於權限看不到。</p>
<p>SdCard內存的資料可在sdcard資料夾中查看到。(可在Android Studio中的Device File Explore中察看)<br>(sdcard/Android/data/[package.name]/[file_name.*])</p>
<h4 id="權限"><a href="#權限" class="headerlink" title="權限"></a>權限</h4><p>需要存取SdCard的權限,添加在AndroidManifest</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>以下範例為在Activity的環境下</p>
<h4 id="要求權限"><a href="#要求權限" class="headerlink" title="要求權限"></a>要求權限</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//取得存取權限</span></span><br><span class="line">       <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">       &#123;</span><br><span class="line">           requestPermissions( <span class="keyword">new</span> String[] &#123; Manifest.permission.WRITE_EXTERNAL_STORAGE,Manifest.permission.READ_EXTERNAL_STORAGE &#125;,<span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">           init();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="meta">@NonNull</span> String[] permissions, <span class="meta">@NonNull</span> <span class="keyword">int</span>[] grantResults)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED &amp;&amp; grantResults[<span class="number">1</span>] == PackageManager.PERMISSION_GRANTED  )</span><br><span class="line">       &#123;</span><br><span class="line">           init();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">       &#123;</span><br><span class="line">           finish();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="SdCard的存取路徑、建立SdCard內存資料夾"><a href="#SdCard的存取路徑、建立SdCard內存資料夾" class="headerlink" title="SdCard的存取路徑、建立SdCard內存資料夾"></a>SdCard的存取路徑、建立SdCard內存資料夾</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File sdroot; <span class="comment">//外存</span></span><br><span class="line">File approot;<span class="comment">//內存</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED))<span class="comment">//判斷SdCard卡狀態</span></span><br><span class="line">    &#123;</span><br><span class="line">        sdroot = Environment.getExternalStorageDirectory(); <span class="comment">//SdCard卡存取檔案的路徑</span></span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;SD卡存取檔案路徑:&quot;</span> + sdroot.getAbsolutePath());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//建立SD卡內存資料夾</span></span><br><span class="line">        approot = <span class="keyword">new</span> File(sdroot, <span class="string">&quot;Android/data/&quot;</span> + getPackageName() + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!approot.exists())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (approot.mkdir()) <span class="comment">//建立成功</span></span><br><span class="line">            &#123;</span><br><span class="line">                Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;mkdir OK&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="comment">//建立失敗</span></span><br><span class="line">            &#123;</span><br><span class="line">                Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;mkdir X&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Environment.getExternalStorageState()用來判斷SdCard卡狀態:<br>若手機裝有SDCard，且可以進行讀寫，則該方法返回的值等於Environment.MEDIA_MOUNTED。</p>
<h4 id="SdCard外存的存取"><a href="#SdCard外存的存取" class="headerlink" title="SdCard外存的存取"></a>SdCard外存的存取</h4><h5 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NewSdrootFile</span><span class="params">()</span><span class="comment">//新增檔案在SD卡的外存</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    File file1 = <span class="keyword">new</span> File(sdroot,<span class="string">&quot;SdrootFile.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(file1);</span><br><span class="line">        fout.write(<span class="string">&quot;OK\n\nHAHA&quot;</span>.getBytes());</span><br><span class="line">        fout.close();</span><br><span class="line"></span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;New OK&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException e)</span><br><span class="line">    &#123;</span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;New File&quot;</span>+e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="讀取"><a href="#讀取" class="headerlink" title="讀取"></a>讀取</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowSdrootFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    File file1 = <span class="keyword">new</span> File(sdroot,<span class="string">&quot;SdrootFile.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file1)));</span><br><span class="line">        String line; StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((line = br.readLine())!= <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sb.append(line+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        br.close();</span><br><span class="line"></span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;SdrootFileData: &quot;</span>+sb);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;讀取SdrootFileData失敗&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SdCard內存的存取"><a href="#SdCard內存的存取" class="headerlink" title="SdCard內存的存取"></a>SdCard內存的存取</h4><h5 id="新增-1"><a href="#新增-1" class="headerlink" title="新增"></a>新增</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NewApprootFile</span><span class="params">()</span><span class="comment">//新增檔案在SD卡的內存</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    File file1 = <span class="keyword">new</span> File(approot,<span class="string">&quot;ApprootFile.txt&quot;</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">try</span> </span><br><span class="line">    &#123;</span><br><span class="line">        FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(file1);</span><br><span class="line">        fout.write(<span class="string">&quot;OK1&quot;</span>.getBytes());</span><br><span class="line">        fout.close();</span><br><span class="line"></span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;New OK&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException e)</span><br><span class="line">    &#123;</span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;New File&quot;</span>+e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="讀取-1"><a href="#讀取-1" class="headerlink" title="讀取"></a>讀取</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowApprootFile</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    File file1 = <span class="keyword">new</span> File(approot,<span class="string">&quot;ApprootFile.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file1)));</span><br><span class="line">        String line; StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((line = br.readLine())!= <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sb.append(line+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        br.close();</span><br><span class="line"></span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;ApprootFileData: &quot;</span>+sb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;讀取ApprootFileData失敗&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h4><p>MainActivity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.ContextCompat;</span><br><span class="line"><span class="keyword">import</span> android.Manifest;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView textView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        textView = findViewById(R.id.TV);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取得存取權限</span></span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">        &#123;</span><br><span class="line">            requestPermissions( <span class="keyword">new</span> String[] &#123; Manifest.permission.WRITE_EXTERNAL_STORAGE,Manifest.permission.READ_EXTERNAL_STORAGE &#125;,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            init();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="meta">@NonNull</span> String[] permissions, <span class="meta">@NonNull</span> <span class="keyword">int</span>[] grantResults)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED &amp;&amp; grantResults[<span class="number">1</span>] == PackageManager.PERMISSION_GRANTED  )</span><br><span class="line">        &#123;</span><br><span class="line">            init();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            finish();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    File sdroot; <span class="comment">//外存</span></span><br><span class="line">    File approot;<span class="comment">//內存</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED))<span class="comment">//判斷SdCard卡狀態</span></span><br><span class="line">        &#123;</span><br><span class="line">            sdroot = Environment.getExternalStorageDirectory(); <span class="comment">//SdCard卡存取檔案的路徑</span></span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;SD卡存取檔案路徑:&quot;</span> + sdroot.getAbsolutePath());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//建立SD卡內存資料夾</span></span><br><span class="line">            approot = <span class="keyword">new</span> File(sdroot, <span class="string">&quot;Android/data/&quot;</span> + getPackageName() + <span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!approot.exists())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (approot.mkdir()) <span class="comment">//建立成功</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;mkdir OK&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="comment">//建立失敗</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Log.v(<span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;mkdir X&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NewSdrootFile</span><span class="params">(View view)</span><span class="comment">//新增檔案在SD卡的外存</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(sdroot,<span class="string">&quot;SdrootFile.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(file1);</span><br><span class="line">            fout.write(<span class="string">&quot;OK\n\nHAHA&quot;</span>.getBytes());</span><br><span class="line">            fout.close();</span><br><span class="line"></span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;New OK&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;New File&quot;</span>+e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowSdrootFile</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(sdroot,<span class="string">&quot;SdrootFile.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file1)));</span><br><span class="line">            String line; StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ((line = br.readLine())!= <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sb.append(line+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            br.close();</span><br><span class="line"></span><br><span class="line">            textView.setText(sb);</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;SdrootFileData: &quot;</span>+sb);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            textView.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;讀取SdrootFileData失敗&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">NewApprootFile</span><span class="params">(View view)</span><span class="comment">//新增檔案在SD卡的內存</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(approot,<span class="string">&quot;ApprootFile.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(file1);</span><br><span class="line">            fout.write(<span class="string">&quot;OK1&quot;</span>.getBytes());</span><br><span class="line">            fout.close();</span><br><span class="line"></span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;New OK&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;New File&quot;</span>+e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowApprootFile</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(approot,<span class="string">&quot;ApprootFile.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(file1)));</span><br><span class="line">            String line; StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ((line = br.readLine())!= <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sb.append(line+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            br.close();</span><br><span class="line">            textView.setText(sb);</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;ApprootFileData: &quot;</span>+sb);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            textView.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;讀取ApprootFileData失敗&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>activity_main</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;新增檔案在SD卡的外存&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;NewSdrootFile&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;新增檔案在SD卡的內存&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;NewApprootFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;顯示在SD卡的外存檔案&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;ShowSdrootFile&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;顯示在SD卡的內存檔案&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;ShowApprootFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:id</span>=<span class="string">&quot;@+id/TV&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://www.youtube.com/watch?v=HiRk_3tznoo&amp;list=PLDwsR4fO8zMYegLEYctGSsmFTu0QkcU6I&amp;index=63">https://www.youtube.com/watch?v=HiRk_3tznoo&amp;list=PLDwsR4fO8zMYegLEYctGSsmFTu0QkcU6I&amp;index=63</a><br><a href="https://codertw.com/android-%E9%96%8B%E7%99%BC/351302/">https://codertw.com/android-%E9%96%8B%E7%99%BC/351302/</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android檔案資料存取</tag>
      </tags>
  </entry>
  <entry>
    <title>Android檔案存取-FileInputStream/FileOutputStream</title>
    <url>/2020/11/30/Android_%E6%AA%94%E6%A1%88%E5%AD%98%E5%8F%96-FileInputStream&amp;FileOutputStream/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Android裡的本地檔案存取</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>資料儲存在手機中APP的一個專用目錄下(每個APP都會有一個專用目錄):<br>data/data/[package.name]/files/[file_name.*]</p>
<p>EX:data/data/com.example.fileaccess/files/data1.txt<br>該檔案可在Android Studio中的Device File Explore中察看</p>
<p>若使用者在設定中清除APP 儲存空間，則files所存的檔案會被清空(為Android本地資料)</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><p>以下範例為在Activity的環境下</p>
<h4 id="創建檔案、存入檔案資料"><a href="#創建檔案、存入檔案資料" class="headerlink" title="創建檔案、存入檔案資料"></a>創建檔案、存入檔案資料</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveFile</span><span class="params">()</span> <span class="comment">//存在內存裡</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//開啟檔案。若檔案不存在則會新創一個該檔名檔案</span></span><br><span class="line">        FileOutputStream fout = <span class="keyword">this</span>.openFileOutput(<span class="string">&quot;data1.txt&quot;</span>, Context.MODE_PRIVATE); </span><br><span class="line"></span><br><span class="line">        fout.write(<span class="string">&quot;Hello\n\nHI&quot;</span>.getBytes());</span><br><span class="line">        fout.flush();</span><br><span class="line">        fout.close();</span><br><span class="line"></span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;Save Ok&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException e)</span><br><span class="line">    &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;Error&quot;</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="指定操作模式"><a href="#指定操作模式" class="headerlink" title="指定操作模式:"></a>指定操作模式:</h5><p>Context.MODE_PRIVATE = 0<br>預設操作模式，該檔案是私有資料，只能被應用本身訪問，在該模式下，檔案依呈現的寫入，寫入的內容會覆蓋原檔案的內容</p>
<p>Context.MODE_APPEND = 32768<br>模式會檢查檔案是否存在，存在的話，新資料會在原檔案資料後追加，否則會建立新檔案。</p>
<p>Context.MODE_WORLD_READABLE = 1<br>表示當前檔案可以被其他應用讀取</p>
<p>Context.MODE_WORLD_WRITEABLE =  2<br>表示當前檔案可以被其他應用寫入</p>
<h4 id="讀取檔案資料"><a href="#讀取檔案資料" class="headerlink" title="讀取檔案資料"></a>讀取檔案資料</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowFile</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        FileInputStream fin = openFileInput(<span class="string">&quot;data1.txt&quot;</span>);</span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(fin));</span><br><span class="line"></span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.v(<span class="string">&quot;Tag&quot;</span>,line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fin.close();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span> (IOException e)</span><br><span class="line">    &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="https://codertw.com/android-%E9%96%8B%E7%99%BC/351302/">https://codertw.com/android-%E9%96%8B%E7%99%BC/351302/</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android檔案資料存取</tag>
      </tags>
  </entry>
  <entry>
    <title>Android自訂字體</title>
    <url>/2021/01/07/Android_%E8%87%AA%E8%A8%82%E5%AD%97%E9%AB%94/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>自訂Android系統中的字體</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>自行從網路上下載文字檔案(OpenType 與 TrueType 皆可)。</p>
<p>另外可選用SIL開源字型授權的字體(SIL Open Font License 1.1)<br>該授權可<br>1 商用，不需付費、知會或標明作者。<br>2 分享檔案、將檔案安裝於任何軟硬體中。<br>3 自由修改。</p>
<h3 id="在Android中使用字體"><a href="#在Android中使用字體" class="headerlink" title="在Android中使用字體"></a>在Android中使用字體</h3><p>將(.ttf/.otf)檔案放進專案(檔案位置app/src/main/assets/fonts)</p>
<p>–&gt;在app夾按右鍵<br>–&gt;New<br>–&gt;Folder<br>–&gt;Assets Folder</p>
<p>在assets創一fonts資料夾將檔案放進專案</p>
<h3 id="使用範例"><a href="#使用範例" class="headerlink" title="使用範例"></a>使用範例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Typeface custom_font = Typeface.createFromAsset(getAssets(), <span class="string">&quot;fonts/NaikaiFont-Regular.ttf&quot;</span>);</span><br><span class="line"></span><br><span class="line">textView.setTypeface(custom_font);</span><br><span class="line"></span><br><span class="line">editText.setTypeface(custom_font);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p><a href="http://tw.gitbook.net/android/android_custom_fonts.html">http://tw.gitbook.net/android/android_custom_fonts.html</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Git基本語法</title>
    <url>/2020/12/02/Git_%E5%9F%BA%E6%9C%AC%E8%AA%9E%E6%B3%95/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Git 常用基本語法</p>
<a id="more"></a>
<h5 id="設定資料"><a href="#設定資料" class="headerlink" title="設定資料"></a>設定資料</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.name &#39;jinling707&#39;</span><br><span class="line">git config --global user.email &#39;jinling707@gmail.com&#39;</span><br></pre></td></tr></table></figure>
<h5 id="查看基本資料"><a href="#查看基本資料" class="headerlink" title="查看基本資料"></a>查看基本資料</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config -l</span><br></pre></td></tr></table></figure>
<h5 id="下載檔案"><a href="#下載檔案" class="headerlink" title="下載檔案"></a>下載檔案</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;jinling707&#x2F;AndroidSQLiteExample.git</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="建立Git庫"><a href="#建立Git庫" class="headerlink" title="建立Git庫"></a>建立Git庫</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>
<h5 id="添加文件"><a href="#添加文件" class="headerlink" title="添加文件"></a>添加文件</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add README.md</span><br></pre></td></tr></table></figure>
<h5 id="建立遠端儲存庫"><a href="#建立遠端儲存庫" class="headerlink" title="建立遠端儲存庫"></a>建立遠端儲存庫</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote add origin https:&#x2F;&#x2F;github.com&#x2F;jinling707&#x2F;AndroidSQLiteExample.git</span><br></pre></td></tr></table></figure>
<h5 id="查看遠端網址"><a href="#查看遠端網址" class="headerlink" title="查看遠端網址"></a>查看遠端網址</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote –v</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="Git狀態"><a href="#Git狀態" class="headerlink" title="Git狀態"></a>Git狀態</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>
<h5 id="把資料放到索引區"><a href="#把資料放到索引區" class="headerlink" title="把資料放到索引區"></a>把資料放到索引區</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line">git add P1.text</span><br></pre></td></tr></table></figure>
<h5 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit –m &quot;Commit Remark&quot;</span><br></pre></td></tr></table></figure>
<p>要修改最後一次的 Commit 訊息，只需直接在 Commit 指令後面加上 –amend 即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit --amend -m &quot;revise Commit&quot;</span><br></pre></td></tr></table></figure>

<h5 id="查看提交歷史"><a href="#查看提交歷史" class="headerlink" title="查看提交歷史"></a>查看提交歷史</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log</span><br><span class="line">git log -4</span><br><span class="line">git log --one line</span><br><span class="line">git log --one line -4</span><br><span class="line">git log --graph --oneline</span><br></pre></td></tr></table></figure>

<h5 id="查看變動"><a href="#查看變動" class="headerlink" title="查看變動"></a>查看變動</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="新增分支"><a href="#新增分支" class="headerlink" title="新增分支"></a>新增分支</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch BranchName</span><br></pre></td></tr></table></figure>
<h5 id="切換分支"><a href="#切換分支" class="headerlink" title="切換分支"></a>切換分支</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout BranchName</span><br></pre></td></tr></table></figure>
<h5 id="檢視所有分支包括本地分支和遠端分支"><a href="#檢視所有分支包括本地分支和遠端分支" class="headerlink" title="檢視所有分支包括本地分支和遠端分支"></a>檢視所有分支包括本地分支和遠端分支</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>
<h5 id="新增BranchName分支，並切換到該分之上"><a href="#新增BranchName分支，並切換到該分之上" class="headerlink" title="新增BranchName分支，並切換到該分之上"></a>新增BranchName分支，並切換到該分之上</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b BranchName</span><br></pre></td></tr></table></figure>
<h5 id="刪除本地分支-不能在該分之上進行刪除"><a href="#刪除本地分支-不能在該分之上進行刪除" class="headerlink" title="刪除本地分支(不能在該分之上進行刪除)"></a>刪除本地分支(不能在該分之上進行刪除)</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -d BranchName</span><br></pre></td></tr></table></figure>
<h5 id="根據-commit-id-回覆到指定版本"><a href="#根據-commit-id-回覆到指定版本" class="headerlink" title="根據 commit id 回覆到指定版本"></a>根據 commit id 回覆到指定版本</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id </span><br></pre></td></tr></table></figure>
<h5 id="合併分支-PR-Pull-Reruest-Merge"><a href="#合併分支-PR-Pull-Reruest-Merge" class="headerlink" title="合併分支(PR=Pull Reruest =Merge)"></a>合併分支(PR=Pull Reruest =Merge)</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge BranchName</span><br></pre></td></tr></table></figure>
<h5 id="取消合併"><a href="#取消合併" class="headerlink" title="取消合併"></a>取消合併</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge --abort</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="將新分支推送至GitHub-可用於推送主分支、分支的Commit"><a href="#將新分支推送至GitHub-可用於推送主分支、分支的Commit" class="headerlink" title="將新分支推送至GitHub(可用於推送主分支、分支的Commit)"></a>將新分支推送至GitHub(可用於推送主分支、分支的Commit)</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin BranchName</span><br></pre></td></tr></table></figure>
<h5 id="強制推送本地分之狀態到遠端-通常用於本地分支與遠程分支不同時"><a href="#強制推送本地分之狀態到遠端-通常用於本地分支與遠程分支不同時" class="headerlink" title="強制推送本地分之狀態到遠端_通常用於本地分支與遠程分支不同時"></a>強制推送本地分之狀態到遠端_通常用於本地分支與遠程分支不同時</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push -f origin BranchName</span><br></pre></td></tr></table></figure>
<h5 id="同步雲端資料-拉下雲端內容"><a href="#同步雲端資料-拉下雲端內容" class="headerlink" title="同步雲端資料(拉下雲端內容)"></a>同步雲端資料(拉下雲端內容)</h5><p>git pull是git fetch和git merge兩個步驟的結合</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git pull origin BranchName</span><br></pre></td></tr></table></figure>

<h5 id="檢視遠端分支"><a href="#檢視遠端分支" class="headerlink" title="檢視遠端分支"></a>檢視遠端分支</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -r</span><br></pre></td></tr></table></figure>
<h5 id="刪除雲端分支-表示刪除分支"><a href="#刪除雲端分支-表示刪除分支" class="headerlink" title="刪除雲端分支(:表示刪除分支)"></a>刪除雲端分支(:表示刪除分支)</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin :BranchName</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Git</category>
      </categories>
  </entry>
  <entry>
    <title>RGB透明顏色值</title>
    <url>/2020/12/28/RGB%E9%80%8F%E6%98%8E%E9%A1%8F%E8%89%B2%E5%80%BC/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>RGB 與 透明度表示</p>
<a id="more"></a>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>RGB任何一種顏色的值範圍都是 0到 255(00到 ff)<br>可在顏色前，加上透明度</p>
<h5 id="透明度-紅色R-綠色G-藍色B"><a href="#透明度-紅色R-綠色G-藍色B" class="headerlink" title="[透明度][紅色R][綠色G][藍色B]"></a>[透明度][紅色R][綠色G][藍色B]</h5><p>範例:#00FF00FF </p>
<table>
<thead>
<tr>
<th>不透明度</th>
<th>16進制值</th>
</tr>
</thead>
<tbody><tr>
<td>100%</td>
<td>FF</td>
</tr>
<tr>
<td>95%</td>
<td>F2</td>
</tr>
<tr>
<td>90%</td>
<td>E6</td>
</tr>
<tr>
<td>85%</td>
<td>D9</td>
</tr>
<tr>
<td>80%</td>
<td>CC</td>
</tr>
<tr>
<td>75%</td>
<td>BF</td>
</tr>
<tr>
<td>70%</td>
<td>B3</td>
</tr>
<tr>
<td>65%</td>
<td>A6</td>
</tr>
<tr>
<td>60%</td>
<td>99</td>
</tr>
<tr>
<td>55%</td>
<td>8C</td>
</tr>
<tr>
<td>50%</td>
<td>80</td>
</tr>
<tr>
<td>45%</td>
<td>73</td>
</tr>
<tr>
<td>40%</td>
<td>66</td>
</tr>
<tr>
<td>35%</td>
<td>59</td>
</tr>
<tr>
<td>30%</td>
<td>4D</td>
</tr>
<tr>
<td>25%</td>
<td>40</td>
</tr>
<tr>
<td>20%</td>
<td>33</td>
</tr>
<tr>
<td>15%</td>
<td>26</td>
</tr>
<tr>
<td>10%</td>
<td>1A</td>
</tr>
<tr>
<td>5%</td>
<td>0D</td>
</tr>
<tr>
<td>0%</td>
<td>00</td>
</tr>
</tbody></table>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>色碼表＆顏色調色盤 <a href="https://www.toolskk.com/color">https://www.toolskk.com/color</a><br>配色模板 <a href="https://coolors.co/palettes/popular">https://coolors.co/palettes/popular</a></p>
]]></content>
      <categories>
        <category>美編</category>
      </categories>
      <tags>
        <tag>美工</tag>
      </tags>
  </entry>
  <entry>
    <title>Android SQLite</title>
    <url>/2020/11/30/Android_SQLite/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>Android中本地的數據資料庫</p>
<a id="more"></a>

<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><p>SQLite不像一般大型資料庫，需先建立好資料庫的實體(如:建立資料庫、建立資料表、計設資料表欄位等)，再經由程式進行存取。<br>SQLite是經由 Android幫你建立的，建立SQLite需要繼承 SQLiteOpenHelper</p>
<p>可在Android Debug Database來查看手機資料庫的狀況</p>
<h4 id="使用Android-Debug-Database"><a href="#使用Android-Debug-Database" class="headerlink" title="使用Android Debug Database"></a>使用Android Debug Database</h4><p>(需使用手機而非模擬器，並開啟網路)<br>在 module 的 build.gradle 中添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">debugImplementation <span class="string">&#x27;com.amitshekhar.android:debug-db:1.0.0&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在執行時，查找Logcat裡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D&#x2F;DebugDB: Open http:&#x2F;&#x2F;XXX.XXX.X.XXX:8080 in your browser</span><br></pre></td></tr></table></figure>
<p>並在瀏覽器中打開網址，便可察看手機資料庫</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="建立資料庫-DBHelper-java"><a href="#建立資料庫-DBHelper-java" class="headerlink" title="建立資料庫 DBHelper.java"></a>建立資料庫 DBHelper.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DBVersion = <span class="number">1</span>;  <span class="comment">//版本</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String DBName = <span class="string">&quot;SampleList.db&quot;</span>;  <span class="comment">//資料庫名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String TableName = <span class="string">&quot;MySample&quot;</span>;  <span class="comment">//資料表名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DBHelper</span><span class="params">(<span class="meta">@Nullable</span> Context context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, DBName, <span class="keyword">null</span>, DBVersion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ID = <span class="string">&quot;_id&quot;</span>; <span class="comment">//primary key 的名字要設定為 _id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;name&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GENDER = <span class="string">&quot;gender&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ADDRESS = <span class="string">&quot;address&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BIRTH = <span class="string">&quot;birth&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WEIGHT = <span class="string">&quot;weight&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TIME = <span class="string">&quot;time&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PHONE = <span class="string">&quot;phone&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    如果 Android 載入時找不到生成的資料庫檔案，就會觸發 onCreate()，所以產生資料表的 SQL 要寫在onCreate()裡。</span></span><br><span class="line"><span class="comment">    一個資料庫可新增、使用多個資料表。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    新增資料表:</span></span><br><span class="line"><span class="comment">    CREATE TABLE IF NOT EXISTS 表格名 (欄位1 資料種類,欄位 2 資料種類, ... );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//版本一</span></span><br><span class="line">        <span class="keyword">final</span> String SQL =</span><br><span class="line">            <span class="string">&quot;CREATE TABLE &quot;</span>+ TableName</span><br><span class="line">            + <span class="string">&quot;(&quot;</span></span><br><span class="line">            + ID        + <span class="string">&quot; INTEGER PRIMARY KEY AUTOINCREMENT&quot;</span> + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + NAME      + <span class="string">&quot; TEXT NOT NULL&quot;</span>                     + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + GENDER    + <span class="string">&quot; VARCHAR(10) DEFAULT &#x27;man&#x27;&quot;</span>         + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + ADDRESS   + <span class="string">&quot; VARCHAR(50)&quot;</span>                       + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + BIRTH     + <span class="string">&quot; DATE NOT NULL&quot;</span>                     + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + WEIGHT    + <span class="string">&quot; FLOAT(2)&quot;</span>                          + <span class="string">&quot;,&quot;</span></span><br><span class="line">            + TIME      + <span class="string">&quot; TIME&quot;</span></span><br><span class="line">            +<span class="string">&quot;)&quot;</span>;</span><br><span class="line">        db.execSQL(SQL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     如果資料庫結構有改變了就會觸發 onUpgrade，需在onUpgrade()中新增兩版本間差異的部分</span></span><br><span class="line"><span class="comment">     oldVersion為上一次執行時所用的版本</span></span><br><span class="line"><span class="comment">     newVersion為我們透過建構子裡super給SQLiteOpenHelper的值</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db,<span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span><span class="comment">//</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="常見資料型態"><a href="#常見資料型態" class="headerlink" title="常見資料型態"></a>常見資料型態</h5><p>數字<br>INTEGER:介於 -2,147,483,648 與 2,147,483,647 間的整數<br>FLOAT:FLOAT(n)  n是儲存 float 數字的小數位數，介於 1 與 53 間<br>DOUBLE</p>
<p>字符<br>CHAR<br>VARCHAR<br>TEXT:可放2的16次方減1個字元，用來儲存大量的資料</p>
<p>時間<br>DATE:日期欄位,格式 yyyy-mm-dd, 範圍 1000-01-01 ~ 19999-12-3。<br>TIME:格式 hh:mm:dd,範圍 -838:59:59 ~ 838:59:59。<br>YEAR:記錄年份,範圍 1901 ~ 2155。<br>DATETIME:日期加上時間,格式yyyy-mm-dd hh:mm:ss,範圍 1000-01-01 00:00:00 ~ 9999-12-31 23:59:59。</p>
<h5 id="PRIMARY-KEY-AUTOINCREMENT"><a href="#PRIMARY-KEY-AUTOINCREMENT" class="headerlink" title="PRIMARY KEY AUTOINCREMENT"></a>PRIMARY KEY AUTOINCREMENT</h5><p>該欄位的數值會自動編號,每增一筆資料時,此欄位自動把編號加一。(此欄位須為索引(主键)、數值資料型態，一個資料表只能有一個欄位使用)。</p>
<h4 id="使用資料庫-CRUD-java"><a href="#使用資料庫-CRUD-java" class="headerlink" title="使用資料庫 CRUD.java"></a>使用資料庫 CRUD.java</h4><p>操作資料庫的增、刪、改、查</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.ContentValues;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.Cursor;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CRUD</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    DBHelper dbHandler;</span><br><span class="line">    SQLiteDatabase db;</span><br><span class="line">    Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] columns =</span><br><span class="line">    &#123;</span><br><span class="line">        DBHelper.ID,</span><br><span class="line">        DBHelper.NAME,</span><br><span class="line">        DBHelper.GENDER,</span><br><span class="line">        DBHelper.ADDRESS,</span><br><span class="line">        DBHelper.BIRTH,</span><br><span class="line">        DBHelper.WEIGHT,</span><br><span class="line">        DBHelper.TIME</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CRUD</span><span class="params">(Context context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> <span class="comment">//開啟資料庫</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dbHandler = <span class="keyword">new</span> DBHelper(mContext);</span><br><span class="line">        db = dbHandler.getWritableDatabase();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="comment">//關閉資料庫</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        dbHandler.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> r =(<span class="keyword">int</span>)(Math.random()*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        ContentValues contentValues = <span class="keyword">new</span> ContentValues();</span><br><span class="line">        <span class="comment">//ID 為 AUTOINCREMENT</span></span><br><span class="line">        contentValues.put( DBHelper.NAME, <span class="string">&quot;小每&quot;</span>+r);</span><br><span class="line">        contentValues.put( DBHelper.GENDER, <span class="string">&quot;woman&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.ADDRESS, <span class="string">&quot;太平洋3街&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.BIRTH, <span class="string">&quot;2050-01-01&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.WEIGHT, <span class="number">45.45687</span>);</span><br><span class="line">        contentValues.put( DBHelper.TIME, <span class="string">&quot;21:59:59&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//return ID(AUTOINCREMENT)的值，失敗為-1</span></span><br><span class="line">        <span class="keyword">return</span> db.insert(DBHelper.TableName, <span class="keyword">null</span>, contentValues);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(String ID)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//return 成功:1，失敗為0</span></span><br><span class="line">        <span class="keyword">return</span> db.delete(DBHelper.TableName, DBHelper.ID + <span class="string">&quot;=?&quot;</span>, <span class="keyword">new</span> String[] &#123;ID&#125;);</span><br><span class="line">        <span class="comment">// 也可這樣寫 db.delete(DBHelper.TableName, DBHelper.ID + &quot;=\&quot;&quot; + ID+&quot;\&quot;&quot;, null);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String ID)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         <span class="keyword">int</span> r =(<span class="keyword">int</span>)(Math.random()*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        ContentValues contentValues = <span class="keyword">new</span> ContentValues();</span><br><span class="line">        contentValues.put( DBHelper.NAME, <span class="string">&quot;小華&quot;</span>+r);</span><br><span class="line">        contentValues.put( DBHelper.GENDER, <span class="string">&quot;man&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.ADDRESS, <span class="string">&quot;太平洋5街&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.BIRTH, <span class="string">&quot;2050-11-01&quot;</span>);</span><br><span class="line">        contentValues.put( DBHelper.WEIGHT, <span class="number">22.478687</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//return 成功:1，失敗為0</span></span><br><span class="line">        <span class="keyword">return</span> db.update(DBHelper.TableName, contentValues,DBHelper.ID + <span class="string">&quot;=?&quot;</span>,<span class="keyword">new</span> String[] &#123;ID&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Cursor cursor = db.query(DBHelper.TableName,columns,DBHelper.GENDER+<span class="string">&quot;=?&quot;</span>,<span class="keyword">new</span> String[]&#123;<span class="string">&quot;man&quot;</span>&#125;,<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(cursor.getCount() &gt; <span class="number">0</span>) <span class="comment">//多筆數量</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(cursor.moveToNext())</span><br><span class="line">            &#123;</span><br><span class="line">                String NAME = cursor.getString(cursor.getColumnIndex(DBHelper.NAME));</span><br><span class="line">                Float WEIGHT = cursor.getFloat(cursor.getColumnIndex(DBHelper.WEIGHT));</span><br><span class="line"></span><br><span class="line">                Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;查到的資料為: &quot;</span>+NAME+<span class="string">&quot; &quot;</span>+ WEIGHT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="比對、找尋的欄位資料為2個以上時"><a href="#比對、找尋的欄位資料為2個以上時" class="headerlink" title="比對、找尋的欄位資料為2個以上時"></a>比對、找尋的欄位資料為2個以上時</h5><p>whereClause/selection:<br>欄位1 = ? and 欄位2 = ?</p>
<p>whereArgs/selectionArgs:不用管資料型態，就算該欄位資料為數字，也是放字串資料<br>new String[]{“欄位1值”,”欄位2值”}</p>
<p>EX:<br>刪除</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db.delete(DBHelper.TableName, DBHelper.ID + <span class="string">&quot;=? and &quot;</span>+DBHelper.GENDER+<span class="string">&quot; =?&quot;</span>, <span class="keyword">new</span> String[] &#123;ID,<span class="string">&quot;woman&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>查看</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db.query(DBHelper.TableName,columns,DBHelper.ID+<span class="string">&quot; =? and &quot;</span>+DBHelper.GENDER + <span class="string">&quot; =?&quot;</span>,<span class="keyword">new</span> String[]&#123;<span class="string">&quot;2&quot;</span>,<span class="string">&quot;woman&quot;</span>&#125;,<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h5 id="刪除資料表"><a href="#刪除資料表" class="headerlink" title="刪除資料表"></a>刪除資料表</h5><p>db.delete(資料表名, null, null);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db.delete(DBHelper.TableName, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<h5 id="設定主鍵-自動遞增-為0"><a href="#設定主鍵-自動遞增-為0" class="headerlink" title="設定主鍵(自動遞增)為0"></a>設定主鍵(自動遞增)為0</h5><p>update sqlite_sequence set seq=0 where name=’資料表名’</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db.execSQL(<span class="string">&quot;update sqlite_sequence set seq=0 where name=&#x27;&quot;</span>+ DBHelper.TableName +<span class="string">&quot;&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="MainActivity-java"><a href="#MainActivity-java" class="headerlink" title="MainActivity.java"></a>MainActivity.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    CRUD crud;</span><br><span class="line">    EditText ET;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        ET = findViewById(R.id.ET);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        crud = <span class="keyword">new</span> CRUD(getApplicationContext());</span><br><span class="line">        crud.open();</span><br><span class="line">        <span class="keyword">long</span> i = crud.add();</span><br><span class="line">        Log.v(<span class="string">&quot;Tag&quot;</span>,<span class="string">&quot;add&quot;</span>+i);</span><br><span class="line">        crud.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        crud = <span class="keyword">new</span> CRUD(getApplicationContext());</span><br><span class="line">        crud.open();</span><br><span class="line">        crud.delete(ET.getText().toString());</span><br><span class="line">        crud.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(View view)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        crud = <span class="keyword">new</span> CRUD(getApplicationContext());</span><br><span class="line">        crud.open();</span><br><span class="line">        crud.update(ET.getText().toString());</span><br><span class="line">        crud.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        crud = <span class="keyword">new</span> CRUD(getApplicationContext());</span><br><span class="line">        crud.open();</span><br><span class="line">        crud.add();</span><br><span class="line">        crud.check();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="activity-main-xml"><a href="#activity-main-xml" class="headerlink" title="activity_main.xml"></a>activity_main.xml</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;增&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;add&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;查&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;check&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;5dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#303F9F&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;刪/改 ID&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#ff0000&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ET&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#ff0000&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;刪&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;delete&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#ff0000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;改&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;update&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#ff0000&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="資料庫Update說明"><a href="#資料庫Update說明" class="headerlink" title="資料庫Update說明"></a>資料庫Update說明</h3><p>APP開展的過程中，若需要修改、更動資料庫，可直接在設定中清除APP資料。然後重新建立資料庫。<br>若是產品已經發布，或是需要保留原先資料庫數據，就必須用Upgrade的方式。<br>Upgrade可讓SQLite新增欄位，但不能對舊欄位做刪改，如欄位名稱、型態都不能改，當然也不能刪除。若真需要做欄位的刪改，須將原先資料庫設為暫時資料庫，待建立新資料庫後，再將資料搬移到新資料庫中。</p>
<h3 id="資料庫Update範例"><a href="#資料庫Update範例" class="headerlink" title="資料庫Update範例"></a>資料庫Update範例</h3><p>1.將新版本的資料表寫在onCreate(如下onCreate的表已改為”版本二”的)<br>2.修改版本變數 DBVersion = 2(該值透過建構子裡super給SQLiteOpenHelper)<br>3.在onUpgrade()中新增兩版本間差異的部分，可用switch來判斷舊版本與新版本間需要做甚麼修改</p>
<p>DBHelper.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> DBVersion = <span class="number">2</span>;  <span class="comment">//版本</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String DBName = <span class="string">&quot;SampleList.db&quot;</span>;  <span class="comment">//資料庫名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String TableName = <span class="string">&quot;MySample&quot;</span>;  <span class="comment">//資料表名</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DBHelper</span><span class="params">(<span class="meta">@Nullable</span> Context context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, DBName, <span class="keyword">null</span>, DBVersion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ID = <span class="string">&quot;_id&quot;</span>; <span class="comment">//primary key 的名字要設定為 _id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = <span class="string">&quot;name&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GENDER = <span class="string">&quot;gender&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ADDRESS = <span class="string">&quot;address&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BIRTH = <span class="string">&quot;birth&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WEIGHT = <span class="string">&quot;weight&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TIME = <span class="string">&quot;time&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PHONE = <span class="string">&quot;phone&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    如果 Android 載入時找不到生成的資料庫檔案，就會觸發 onCreate()，所以產生資料表的 SQL 要寫在onCreate()裡。</span></span><br><span class="line"><span class="comment">    一個資料庫可新增、使用多個資料表。</span></span><br><span class="line"><span class="comment">    新增資料表:</span></span><br><span class="line"><span class="comment">    CREATE TABLE IF NOT EXISTS 表格名 (欄位1 資料種類,欄位 2 資料種類, ... );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">       <span class="comment">//版本二</span></span><br><span class="line">       <span class="keyword">final</span> String SQL =</span><br><span class="line">               <span class="string">&quot;CREATE TABLE &quot;</span>+ TableName</span><br><span class="line">                       + <span class="string">&quot;(&quot;</span></span><br><span class="line">                       + ID        + <span class="string">&quot; INTEGER PRIMARY KEY AUTOINCREMENT&quot;</span> + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + NAME      + <span class="string">&quot; TEXT NOT NULL&quot;</span>                     + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + GENDER    + <span class="string">&quot; VARCHAR(10) DEFAULT &#x27;man&#x27;&quot;</span>         + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + ADDRESS   + <span class="string">&quot; VARCHAR(50)&quot;</span>                       + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + BIRTH     + <span class="string">&quot; DATE NOT NULL&quot;</span>                     + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + WEIGHT    + <span class="string">&quot; FLOAT(2)&quot;</span>                          + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + TIME      + <span class="string">&quot; TIME&quot;</span>                              + <span class="string">&quot;,&quot;</span></span><br><span class="line">                       + PHONE     + <span class="string">&quot; TEXT&quot;</span></span><br><span class="line">                       +<span class="string">&quot;)&quot;</span>;</span><br><span class="line">       db.execSQL(SQL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     如果資料庫結構有改變了就會觸發 onUpgrade，需在onUpgrade()中新增兩版本間差異的部分</span></span><br><span class="line"><span class="comment">     oldVersion為上一次執行時所用的版本</span></span><br><span class="line"><span class="comment">     newVersion為我們透過建構子裡super給SQLiteOpenHelper的值</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db,<span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span><span class="comment">//</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//用switch來判斷舊版本與新版本間需要做甚麼修改</span></span><br><span class="line">        <span class="keyword">switch</span> (oldVersion) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="comment">//方法一:新增兩版本差異的部分</span></span><br><span class="line">                String sql = <span class="string">&quot;ALTER TABLE &quot;</span> + TableName + <span class="string">&quot; ADD &quot;</span> + PHONE + <span class="string">&quot; TEXT&quot;</span>;</span><br><span class="line">                db.execSQL(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//                //方法二:使用TEMP搬移資料</span></span><br><span class="line"><span class="comment">//                //將舊資料表重新命名</span></span><br><span class="line"><span class="comment">//                db.execSQL(&quot;ALTER TABLE &quot;+TableName +&quot; RENAME TO &quot;+&quot;TEMP_TABLE&quot;);</span></span><br><span class="line"><span class="comment">//                //建立新資料表</span></span><br><span class="line"><span class="comment">//                db.execSQL(&quot;DROP TABLE IF EXISTS &quot;+TableName);</span></span><br><span class="line"><span class="comment">//                final String SQL =</span></span><br><span class="line"><span class="comment">//                    &quot;CREATE TABLE &quot;+ TableName</span></span><br><span class="line"><span class="comment">//                            + &quot;(&quot;</span></span><br><span class="line"><span class="comment">//                            + ID        + &quot; INTEGER PRIMARY KEY AUTOINCREMENT&quot; + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + NAME      + &quot; TEXT NOT NULL&quot;                     + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + GENDER    + &quot; VARCHAR(10) DEFAULT &#x27;man&#x27;&quot;         + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + ADDRESS   + &quot; VARCHAR(50)&quot;                       + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + BIRTH     + &quot; DATE NOT NULL&quot;                     + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + WEIGHT    + &quot; FLOAT(2)&quot;                          + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + TIME      + &quot; TIME&quot;                              + &quot;,&quot;</span></span><br><span class="line"><span class="comment">//                            + PHONE     + &quot; TEXT&quot;</span></span><br><span class="line"><span class="comment">//                            +&quot;)&quot;;</span></span><br><span class="line"><span class="comment">//                db.execSQL(SQL);</span></span><br><span class="line"><span class="comment">//                //將舊資料insert到新的資料表</span></span><br><span class="line"><span class="comment">//                db.execSQL(&quot;INSERT INTO &quot;+TableName+&quot; (&quot;+NAME+&quot;, &quot;+BIRTH+&quot;) &quot; +&quot;SELECT &quot;+NAME+&quot;,&quot;+ BIRTH +&quot; FROM &quot;+&quot;TEMP_TABLE&quot;);</span></span><br><span class="line"><span class="comment">//                //刪除舊資料表</span></span><br><span class="line"><span class="comment">//                db.execSQL(&quot;DROP TABLE IF EXISTS &quot;+&quot;TEMP_TABLE&quot;);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若是單純的增加資料表欄位，在onUpgrade可用方法一來新增兩版本差異的部分<br>而若是資料表需要修、刪，可用方法二，將原先資料庫設為暫時資料庫，待建立新資料庫後，再將資料搬移到新資料庫中。</p>
<p>註:Android的SQLite省去了一些標準SQL的特性，並且加入了一些自己的新特性,因此ALTER TABLE ADD的部分不能一次添加多個欄位，需要一個一個慢慢加，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String sql = <span class="string">&quot;ALTER TABLE &quot;</span> + TableName + <span class="string">&quot; ADD &quot;</span> + PHONE + <span class="string">&quot; TEXT&quot;</span>;</span><br><span class="line">db.execSQL(sql);</span><br><span class="line">String sql2 = <span class="string">&quot;ALTER TABLE &quot;</span> + TableName + <span class="string">&quot; ADD &quot;</span> + PHONE2 + <span class="string">&quot; TEXT&quot;</span>;</span><br><span class="line">db.execSQL(sql2);</span><br></pre></td></tr></table></figure>

<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>Android Debug Database:<br><a href="https://www.itread01.com/content/1544582526.html">https://www.itread01.com/content/1544582526.html</a><br>SQLite:<br><a href="https://sweeteason.pixnet.net/blog/post/37364146-android-%E4%BD%BF%E7%94%A8-sqlite-%E8%B3%87%E6%96%99%E5%BA%AB%E7%9A%84%E6%96%B9%E6%B3%95">https://sweeteason.pixnet.net/blog/post/37364146-android-%E4%BD%BF%E7%94%A8-sqlite-%E8%B3%87%E6%96%99%E5%BA%AB%E7%9A%84%E6%96%B9%E6%B3%95</a><br>onUpgrade:<br><a href="https://mrraybox.blogspot.com/2017/01/android-sqlite-onupgrade.html">https://mrraybox.blogspot.com/2017/01/android-sqlite-onupgrade.html</a><br><a href="https://ithelp.ithome.com.tw/articles/10188563">https://ithelp.ithome.com.tw/articles/10188563</a><br>SQL資料型態:<br><a href="https://codingboy.pixnet.net/blog/post/26919164">https://codingboy.pixnet.net/blog/post/26919164</a><br>PHP+MySQL 快速入門(滄海)</p>
<h3 id="檔案下載"><a href="#檔案下載" class="headerlink" title="檔案下載"></a>檔案下載</h3><p>檔案下載: <a href="https://github.com/jinling707/AndroidSQLiteExample">Download Code</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android檔案資料存取</tag>
      </tags>
  </entry>
</search>
