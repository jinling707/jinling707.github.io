<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ForegroundService</title>
    <url>/2020/11/13/Android_ForegroundService/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>使用前台服務須創造一通知，讓用戶主動意識到您的應用正在前台執行任務，並且正在消耗系統資源。除非服務已停止或從前台刪除，否則無法取消該通知。</p>
<a id="more"></a>

<p>前台服務的應用示例包括：<br>在前台服務中播放音樂的音樂播放器應用。該通知可能會顯示當前正在播放的歌曲。<br>健身應用程序，在收到用戶的許可後，將其記錄在前台服務中。該通知可能會顯示用戶在當前健身會話期間旅行的距離。</p>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="權限"><a href="#權限" class="headerlink" title="權限"></a>權限</h4><p>Android 9（API級別28）或更高版本，使用必須添加權限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<h4 id="開啟foreground-service"><a href="#開啟foreground-service" class="headerlink" title="開啟foreground service"></a>開啟foreground service</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,</span><br><span class="line">        <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">Notification notification = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, CHANNEL_ID)</span><br><span class="line">        .setContentTitle(<span class="string">&quot;下拉列表中的Title&quot;</span>)</span><br><span class="line">        .setContentText(<span class="string">&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;</span>) <span class="comment">//過多的字以...呈現</span></span><br><span class="line">        <span class="comment">//.setStyle(new NotificationCompat.BigTextStyle().bigText(&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;)) //顯示完整內容</span></span><br><span class="line">        .setSmallIcon(R.drawable.ic_cake)<span class="comment">// 設置狀態攔下小圖標，建議大小為32x32</span></span><br><span class="line">        .setContentIntent(pendingIntent)</span><br><span class="line">        .setLargeIcon(BitmapFactory.decodeResource(getResources(),R.drawable.smile)) <span class="comment">// 設置狀態攔下大圖標，建議用PNG，大小為64x64</span></span><br><span class="line">        .setWhen(System.currentTimeMillis())<span class="comment">// 設置通知發生時間</span></span><br><span class="line">        .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;Stop&quot;</span>, pStopSelf)</span><br><span class="line">        .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;NewActivity&quot;</span>, newActivity)</span><br><span class="line">        .setDefaults(Notification.DEFAULT_ALL) <span class="comment">// 加上提醒效果:震動(DEFAULT_VIBRATE)，音效(DEFAULT_VIBRATE)，燈光(DEFAULT_LIGHT)</span></span><br><span class="line">        <span class="comment">//若有用到震動則需在AndroidManifest.xml加入權限&lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;</span></span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">startForeground(<span class="number">1</span>, notification);</span><br></pre></td></tr></table></figure>
<h4 id="提醒"><a href="#提醒" class="headerlink" title="提醒"></a>提醒</h4><p>使用Service需在AndroidManifest.xml加入Service 類別</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;.ForegroundService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.androidforegroundserviceexample;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startService</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Start Foreground Service in Android&quot;</span>);</span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STARTFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        startService(serviceIntent);</span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">// startService(serviceIntent);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stopService</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Stop Foreground Service in Android&quot;</span>);</span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        startService(serviceIntent);</span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">//stopService(serviceIntent);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="activity-main"><a href="#activity-main" class="headerlink" title="activity_main"></a>activity_main</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonStartService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Start Service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;startService&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/buttonStopService&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Stop Service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">&quot;stopService&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ForegroundService"><a href="#ForegroundService" class="headerlink" title="ForegroundService"></a>ForegroundService</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.androidforegroundserviceexample;</span><br><span class="line"><span class="keyword">import</span> android.app.Notification;</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationChannel;</span><br><span class="line"><span class="keyword">import</span> android.app.NotificationManager;</span><br><span class="line"><span class="keyword">import</span> android.app.PendingIntent;</span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.media.MediaPlayer;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.NotificationCompat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForegroundService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Log.v(<span class="string">&quot;ForegroundService&quot;</span>,<span class="string">&quot;onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通知跳轉業面</span></span><br><span class="line">        PendingIntent newActivity = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>, NewActivity.class), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通知關閉Service</span></span><br><span class="line">        Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForegroundService.class);</span><br><span class="line">        serviceIntent.putExtra(<span class="string">&quot;inputExtra&quot;</span>, <span class="string">&quot;Stop Foreground Service in Android&quot;</span>);</span><br><span class="line">        serviceIntent.setAction(<span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>);</span><br><span class="line">        PendingIntent pStopSelf = PendingIntent.getService(<span class="keyword">this</span>, <span class="number">0</span>, serviceIntent, PendingIntent.FLAG_CANCEL_CURRENT);</span><br><span class="line">      </span><br><span class="line">        <span class="comment">/************************/</span></span><br><span class="line">        String input = intent.getStringExtra(<span class="string">&quot;inputExtra&quot;</span>);</span><br><span class="line">        Log.v(<span class="string">&quot;ForegroundService&quot;</span> , input);</span><br><span class="line"></span><br><span class="line">        Intent notificationIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>,</span><br><span class="line">                <span class="number">0</span>, notificationIntent, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        Notification notification = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, CHANNEL_ID)</span><br><span class="line">                .setContentTitle(<span class="string">&quot;下拉列表中的Title&quot;</span>)</span><br><span class="line">                .setContentText(<span class="string">&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;</span>) <span class="comment">//過多的字以...呈現</span></span><br><span class="line">                <span class="comment">//.setStyle(new NotificationCompat.BigTextStyle().bigText(&quot;要显示的内容 要显示的内容 要显示的内容 要显示的内容&quot;)) //顯示完整內容</span></span><br><span class="line">                .setSmallIcon(R.drawable.ic_cake)<span class="comment">// 設置狀態攔下小圖標，建議大小為32x32</span></span><br><span class="line">                .setContentIntent(pendingIntent)</span><br><span class="line">                .setLargeIcon(BitmapFactory.decodeResource(getResources(),R.drawable.smile)) <span class="comment">// 設置狀態攔下大圖標，建議用PNG，大小為64x64</span></span><br><span class="line">                .setWhen(System.currentTimeMillis())<span class="comment">// 設置通知發生時間</span></span><br><span class="line">                .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;Stop&quot;</span>, pStopSelf)</span><br><span class="line">                .addAction(R.drawable.ic_launcher_foreground, <span class="string">&quot;NewActivity&quot;</span>, newActivity)</span><br><span class="line">                .setDefaults(Notification.DEFAULT_ALL) <span class="comment">// 加上提醒效果:震動(DEFAULT_VIBRATE)，音效(DEFAULT_VIBRATE)，燈光(DEFAULT_LIGHT)</span></span><br><span class="line">                <span class="comment">//若有用到震動則需在AndroidManifest.xml加入權限&lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法一</span></span><br><span class="line">        <span class="keyword">if</span> (intent.getAction().equals( <span class="string">&quot;STARTFOREGROUND_ACTION&quot;</span>)) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;ForegroundService&quot;</span>, <span class="string">&quot;Received Start Foreground Intent &quot;</span>);</span><br><span class="line">            startForeground(<span class="number">1</span>, notification);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (intent.getAction().equals( <span class="string">&quot;STOPFOREGROUND_ACTION&quot;</span>)) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;ForegroundService&quot;</span>, <span class="string">&quot;Received Stop Foreground Intent&quot;</span>);</span><br><span class="line">            stopForeground(<span class="keyword">true</span>);</span><br><span class="line">            stopSelfResult(startId);</span><br><span class="line">            <span class="comment">//stopSelf();//停止Service</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法二</span></span><br><span class="line">        <span class="comment">// startForeground(1, notification);</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> START_NOT_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>onStartCommand() 的回傳值決定 Service 被殺掉時要怎麼做對應的處理:<br>START_NOT_STICKY：如果系統在 onStartCommand() 後終止 Service，除非有待決的 intent 要傳送，否則請「不要」建立 Service。<br>START_STICKY：如果系統在 onStartCommand() 後終止 Service，請重新建立 Service 並呼叫 onStartCommand()，但「不要」重新傳送最後的 intent。 相反地，除非有待決的 intent 要啟動 service，否則系統會使用 null intent 呼叫，適用於媒體播放程式 。<br>START_REDELIVER_INTENT：如果系統在 onStartCommand() 後終止 Service，請重新建立 Service 並使用傳送至 Service的最後 intent 呼叫onStartCommand()。適用的 Service 為主動執行如下載檔案等應該立即繼續的工作。</p>
<p>PendingIntent有以下flag：<br>FLAG_CANCEL_CURRENT:如果當前系統中已經存在一個相同的PendingIntent對象，那麼就將先將已有的PendingIntent取消，然後重新生成一個PendingIntent對象。<br>FLAG_NO_CREATE:如果當前系統中不存在相同的PendingIntent對象，系統將不會創建該PendingIntent對象而是直接返回null。<br>FLAG_ONE_SHOT:該PendingIntent只作用一次。<br>FLAG_UPDATE_CURRENT:如果系統中已存在該PendingIntent對象，那麼系統將保留該PendingIntent對象，但是會使用新的Intent來更新之前PendingIntent中的Intent對像數據，例如更新Intent中的Extras。<br>創建PendingIntent方式：<br>PendingIntent.getActivity (context, requestCode, broadIntent, flags)<br>PendingIntent.getBroadcast(context,requestCode, broadIntent, flags)<br>PendingIntent.getService (context, requestCode, broadIntent, flags)</p>
<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔<br><a href="https://developer.android.com/guide/components/foreground-services">https://developer.android.com/guide/components/foreground-services</a><br>Foreground Service<br><a href="https://androidwave.com/foreground-service-android-example/">https://androidwave.com/foreground-service-android-example/</a><br>PendingIntent<br><a href="https://blog.csdn.net/yangwen123/article/details/8019739">https://blog.csdn.net/yangwen123/article/details/8019739</a></p>
<h3 id="檔案下載"><a href="#檔案下載" class="headerlink" title="檔案下載"></a>檔案下載</h3><p>檔案下載: <a href="https://github.com/jinling707/AndroidForegroundServiceExample">Download Code</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android Service</tag>
      </tags>
  </entry>
  <entry>
    <title>Permission</title>
    <url>/2020/11/17/Android_Permission/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>權限的目的是保護Android用戶的隱私。<br>在Android6 sdk23 以上要求使用。</p>
<a id="more"></a>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="普通權限"><a href="#普通權限" class="headerlink" title="普通權限"></a>普通權限</h4><p>對用戶的隱私或其他應用的操作風險很小。需在Manifest聲明，但不需詢問使用者同意便可使用。</p>
<h4 id="危險權限"><a href="#危險權限" class="headerlink" title="危險權限"></a>危險權限</h4><p>需要涉及用戶私人信息、數據或資源的區域，或可能影響用戶存儲的數據，或是其他應用程序的操作。需在Manifest聲明，且需詢問使用者的同意才可使用。</p>
<h5 id="危險權限-權限組"><a href="#危險權限-權限組" class="headerlink" title="危險權限-權限組"></a>危險權限-權限組</h5><p>所有危險的 Android 系統權限都屬於權限組。<br>向用戶要求權限的對話框不會描述該具體權限，例如，如果應用請求 READ_CONTACTS 權限，系統對話框只說明該應用需要訪問設備的聯繫信息。而在該權限組中，只要有其中一權限被使用者允許，則該權限組的所有權限皆視為允許。</p>
<p>權限組查詢<br><a href="https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#%E6%9D%83%E9%99%90%E7%BA%A7%E5%88%AB">https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#%E6%9D%83%E9%99%90%E7%BA%A7%E5%88%AB</a><br>權限說明<br><a href="https://developer.android.com/reference/android/Manifest.permission#SMS_FINANCIAL_TRANSACTIONS">https://developer.android.com/reference/android/Manifest.permission#SMS_FINANCIAL_TRANSACTIONS</a></p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="聲明權限"><a href="#聲明權限" class="headerlink" title="聲明權限"></a>聲明權限</h4><p>AndroidManifest</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">//定位權限組</span><br><span class="line">//網路定位</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line">//GPS</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">//訊息權限組</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECEIVE_SMS&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_SMS&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_SMS&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="檢查、要求權限"><a href="#檢查、要求權限" class="headerlink" title="檢查、要求權限"></a>檢查、要求權限</h4><h5 id="檢查權限"><a href="#檢查權限" class="headerlink" title="檢查權限:"></a>檢查權限:</h5><p>ContextCompat.checkSelfPermission(context, Manifest.permission.權限名)<br>回傳-1:不允許此權限<br>回傳0:允許此權限</p>
<h5 id="要求權限"><a href="#要求權限" class="headerlink" title="要求權限:"></a>要求權限:</h5><p>this.requestPermissions(new String[]{Manifest.permission.權限名}, requestCode);</p>
<h5 id="兩個以上權限組的範例"><a href="#兩個以上權限組的範例" class="headerlink" title="兩個以上權限組的範例:"></a>兩個以上權限組的範例:</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.RECEIVE_SMS) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) <span class="comment">// 判斷裝置版本是否大於SDK23</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.RECEIVE_SMS&#125;, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同一權限組的只需派一代表檢查與對其進行權限要求即可。</p>
<h4 id="權限要求對話框的互動結果"><a href="#權限要求對話框的互動結果" class="headerlink" title="權限要求對話框的互動結果"></a>權限要求對話框的互動結果</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">       <span class="keyword">if</span> (requestCode == <span class="number">1</span>)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (grantResults[<span class="number">0</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">               Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕Location權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (grantResults[<span class="number">1</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">               Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕SMS權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>註:後面的Toast指令會覆蓋掉前面的</p>
<h3 id="補充"><a href="#補充" class="headerlink" title="補充"></a>補充</h3><p>使用者若是多次拒絕權限對話框的詢問或是對此權限勾選”不再詢問”，會導致requestPermissions將不再工作(用shouldShowRequestPermissionRationale來判斷)。<br>此時可將使用者導到APP設定畫面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//裝置未授予此權限，且拒絕被訪問權限，直接導到設定頁面</span></span><br><span class="line"><span class="keyword">if</span>(!ActivityCompat.shouldShowRequestPermissionRationale(MainActivity.<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION ) &amp;&amp;</span><br><span class="line">        ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line">    openAppSettingsIntent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>shouldShowRequestPermissionRationale:<br>回傳true(允許說明) 1.請求權限被禁止，但未選擇【不再提醒】<br>回傳false(不須再說明–&gt;無法使用requestPermissions):1.第一次請求權限時 2.使用者堅決不給權限，已勾選別再詢問我  3.已允許權限</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openAppSettingsIntent</span><span class="params">()</span><span class="comment">//前往系統設定頁面</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="comment">//因無法直接導到「權限」選單裡，只能到應用程式資訊頁面 --&gt;ACTION_APPLICATION_DETAILS_SETTINGS</span></span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.fromParts(<span class="string">&quot;package&quot;</span>, getPackageName(), <span class="keyword">null</span>));</span><br><span class="line">    intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.core.app.ActivityCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.ContextCompat;</span><br><span class="line"><span class="keyword">import</span> android.Manifest;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.RECEIVE_SMS) != PackageManager.PERMISSION_GRANTED)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) <span class="comment">// 判斷裝置版本是否大於SDK23</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.RECEIVE_SMS&#125;, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//裝置未授予此權限，且拒絕被訪問權限，直接導到設定頁面</span></span><br><span class="line">        <span class="keyword">if</span>(!ActivityCompat.shouldShowRequestPermissionRationale(MainActivity.<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION ) &amp;&amp;</span><br><span class="line">                ContextCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED</span><br><span class="line">        )</span><br><span class="line">        &#123;</span><br><span class="line">            openAppSettingsIntent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**shouldShowRequestPermissionRationale</span></span><br><span class="line"><span class="comment">         * 回傳true(允許說明) 1.請求權限被禁止，但未選擇【不再提醒】</span></span><br><span class="line"><span class="comment">         * 回傳false(不須再說明--&gt;無法使用requestPermissions):1.第一次請求權限時 2.使用者堅決不給權限，已勾選別再詢問我  3.已允許權限</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">        <span class="keyword">if</span> (requestCode == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">0</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕Location權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">1</span>] != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;拒絕SMS權限會導致程式中某些功能無法如常運作&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">openAppSettingsIntent</span><span class="params">()</span><span class="comment">//前往系統設定頁面</span></span></span><br><span class="line"><span class="function">    </span>&#123;   <span class="comment">//無法直接導到「權限」選單裡，只能到應用程式資訊頁面 --&gt;ACTION_APPLICATION_DETAILS_SETTINGS</span></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS, Uri.fromParts(<span class="string">&quot;package&quot;</span>, getPackageName(), <span class="keyword">null</span>));</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔<br><a href="https://developer.android.com/guide/topics/permissions/overview">https://developer.android.com/guide/topics/permissions/overview</a><br>官方範例<br><a href="https://developer.android.com/training/permissions/requesting">https://developer.android.com/training/permissions/requesting</a><br>範例<br><a href="https://myapollo.com.tw/zh-tw/polly-android-runtime-permissions/">https://myapollo.com.tw/zh-tw/polly-android-runtime-permissions/</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>SdkVersion</title>
    <url>/2020/11/17/Android_SdkVersion/</url>
    <content><![CDATA[<h3 id="簡介"><a href="#簡介" class="headerlink" title="簡介"></a>簡介</h3><p>介紹minSdkVersion、compileSdkVersion、targetSdkVersion<br>可通過API的級別來表示應用程序與Android平台的一個或多個版本的兼容性</p>
<a id="more"></a>
<h3 id="說明"><a href="#說明" class="headerlink" title="說明"></a>說明</h3><h4 id="minSdkVersion"><a href="#minSdkVersion" class="headerlink" title="minSdkVersion"></a>minSdkVersion</h4><p>App最小可以支援的版本。(可由Android Studio查詢現有行動裝置的版本比例，藉此確定使用minSdkVersion級別)<br>在Play Store中，用戶的裝置版本若小於APP的minSdkVersion，那Play Store便不向該用戶顯示此App。</p>
<p>在開發時，會依minSdkVersion來警告你，是否用了高於minSdkVersion的API，避免調用不存在的API，造成運行問題。</p>
<h4 id="compileSdkVersion"><a href="#compileSdkVersion" class="headerlink" title="compileSdkVersion"></a>compileSdkVersion</h4><p>Gradle用的AndroidSDK編譯版本。<br>官方強烈推薦用最新的SDK進行編譯<br>(在開發中的應用程式，提醒已棄用的API，也為使用新的API做好準備)</p>
<h4 id="targetSdkVersion"><a href="#targetSdkVersion" class="headerlink" title="targetSdkVersion"></a>targetSdkVersion</h4><p>App最合適的版本，最低通常須依Googlee規定<br>也是向前兼容的主要依據:如果裝置API級別高於您的應用程序聲明的targetSdkVersion，則係統可能會啟用兼容性行為，以確保您的應用程序繼續按您期望的方式運行。<br>舉例:<br>在Android 6.0（API 级别23）及更高版本中，使用一些相對敏感的權限時，需要徵求用戶的許可。<br>若target sdk &lt; 23 ，Android 則會自動用 23 以下的 api 運行，而若是APP運行在android 6.0或以上版本，且target sdk&gt;=23，便需要向其徵求敏感權限的使用。</p>
<h3 id="範例"><a href="#範例" class="headerlink" title="範例"></a>範例</h3><h4 id="設定位置"><a href="#設定位置" class="headerlink" title="設定位置"></a>設定位置</h4><p>build.gradle</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">30</span></span><br><span class="line">    buildToolsVersion <span class="string">&quot;30.0.1&quot;</span></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.xxx.xxx&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">18</span></span><br><span class="line">        targetSdkVersion <span class="number">26</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="版本判斷及應變"><a href="#版本判斷及應變" class="headerlink" title="版本判斷及應變"></a>版本判斷及應變</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) </span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h3><p>官方文檔 <a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element">https://developer.android.com/guide/topics/manifest/uses-sdk-element</a><br><a href="https://willy2016.pixnet.net/blog/post/215759103">https://willy2016.pixnet.net/blog/post/215759103</a></p>
]]></content>
      <categories>
        <category>Android</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World2000 哈囉</title>
    <url>/2018/04/11/hello-world2/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>程式</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>前端</tag>
      </tags>
  </entry>
</search>
